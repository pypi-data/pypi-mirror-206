"use strict";(self.webpackChunk_cmd_ntrf_jupyterlab_lmod=self.webpackChunk_cmd_ntrf_jupyterlab_lmod||[]).push([[510],{668:(t,e)=>{class n{constructor(t){var e;this.url=t+"lmod",this._xsrf=("_xsrf",(e=document.cookie.match("\\b_xsrf=([^;]*)\\b"))?e[1]:void 0)}async avail(){const t=await fetch(this.url+"/modules");if(200==t.status)return t.json()}async list(t=!1){let e=this.url;t&&(e+="?all=true");const n=await fetch(e);if(200==n.status)return n.json()}async load(t){const e={modules:t};return(await fetch(this.url,{method:"POST",headers:{"Content-Type":"application/json","X-XSRFToken":this._xsrf},body:JSON.stringify(e)})).json()}async restore(t){const e={name:t};return(await fetch(this.url+"/collections",{method:"PATCH",headers:{"Content-Type":"application/json","X-XSRFToken":this._xsrf},body:JSON.stringify(e)})).json()}async save(t){const e={name:t};return(await fetch(this.url+"/collections",{method:"POST",headers:{"Content-Type":"application/json","X-XSRFToken":this._xsrf},body:JSON.stringify(e)})).json()}async savelist(){const t=await fetch(this.url+"/collections");if(200==t.status)return t.json()}async show(t){const e=await fetch(this.url+"/modules/"+t);if(200==e.status)return e.json()}async freeze(){const t=await fetch(this.url+"?lang=python");if(200==t.status)return t.json()}async unload(t){const e={modules:t};return(await fetch(this.url,{method:"DELETE",headers:{"Content-Type":"application/json","X-XSRFToken":this._xsrf},body:JSON.stringify(e)})).json()}async paths(){const t=await fetch(this.url+"/paths");if(200==t.status)return t.json()}async folders(t){const e=await fetch(this.url+"/folders/"+t);if(200==e.status)return e.json()}async use(t,e=!1){const n={paths:t,append:e};return(await fetch(this.url+"/paths",{method:"POST",headers:{"Content-Type":"application/json","X-XSRFToken":this._xsrf},body:JSON.stringify(n)})).json()}async unuse(t){const e={paths:t};return(await fetch(this.url+"/paths",{method:"DELETE",headers:{"Content-Type":"application/json","X-XSRFToken":this._xsrf},body:JSON.stringify(e)})).json()}}t.exports={Lmod:n};try{e.Lmod=n}catch(t){}},510:function(t,e,n){var s=this&&this.__createBinding||(Object.create?function(t,e,n,s){void 0===s&&(s=n),Object.defineProperty(t,s,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,s){void 0===s&&(s=n),t[s]=e[n]}),o=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),a=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&s(e,t,n);return o(e,t),e};Object.defineProperty(e,"__esModule",{value:!0});const i=n(687),l=n(33),r=n(832),d=n(467),c=n(142),u=n(668),h=a(n(559));function p(t,e){const n=document.createElement("li"),s=document.createElement("span"),o=document.createElement("button");return n.append(s),n.append(o),n.setAttribute("class","jp-Lmod-item"),s.setAttribute("class","jp-Lmod-itemLabel"),s.innerText=t,o.setAttribute("class","jp-Lmod-itemButton jp-mod-styled"),o.innerHTML=e,n}const m=new u.Lmod(c.PageConfig.getBaseUrl());var f=null,b=null,y={},v={};async function j(){const t=await m.freeze();l.showDialog({title:"Export modules",body:new S("Add this in a notebook to load the same modules :",t),buttons:[l.Dialog.okButton()]})}function L(t){return l.showDialog({title:"Save collection",body:new C,buttons:[l.Dialog.cancelButton(),l.Dialog.okButton({label:"Save"})]}).then((t=>{if("Save"===t.button.label){let e=t.value;m.save(e||"default")}}))}class w extends r.Widget{constructor(){super(),this.id="lmod-jupyterlab",this.title.caption="Softwares",this.title.iconClass="jp-LmodIcon jp-SideBar-tabIcon",this.addClass("jp-Lmod");const t=document.createElement("div"),e=document.createElement("div");this.searchInput=document.createElement("input"),t.setAttribute("class","jp-Lmod-search"),e.setAttribute("class","jp-Lmod-search-wrapper"),this.searchInput.setAttribute("id","modules"),this.searchInput.setAttribute("class","jp-Lmod-input"),this.searchInput.setAttribute("placeholder","Filter available modules..."),t.appendChild(e),e.appendChild(this.searchInput),this.node.insertAdjacentElement("afterbegin",t),this.node.insertAdjacentHTML("beforeend",'<div id="lmod" class="jp-Lmod-content">\n          <div class="jp-Lmod-section">\n              <div class="jp-Lmod-sectionHeader"><H2>Loaded Modules</H2>\n                  <button\n                    title="Create collection"\n                    class="jp-Lmod-collectionButton jp-mod-styled jp-AddIcon"\n                    id="save-button"\n                  ></button>\n                  <button\n                    title="Restore collection"\n                    class="jp-Lmod-collectionButton jp-mod-styled jp-UndoIcon"\n                    id="restore-button"\n                  ></button>\n                  <button\n                    title="Generate Python code"\n                    class="jp-Lmod-collectionButton jp-mod-styled jp-CopyIcon"\n                    id="export-button"\n                  ></button>\n              </div>\n              <div class="jp-Lmod-sectionContainer">\n                  <ul class="jp-Lmod-sectionList" id="lmod_loaded_list">\n                  </ul>\n              </div>\n          </div>\n          <div class="jp-Lmod-section">\n              <div class="jp-Lmod-sectionHeader">\n                <h2 id="lmod_avail_header">Available Modules</h2>\n              </div>\n              <div class="jp-Lmod-sectionContainer">\n                <ul class="jp-Lmod-sectionList" id="lmod_avail_list">\n                </ul>\n              </div>\n          </div>\n      </div>'),this.loadedUList=this.node.querySelector("#lmod_loaded_list"),this.availUList=this.node.querySelector("#lmod_avail_list"),this.availHeader=this.node.querySelector("#lmod_avail_header"),this.loadedUList.addEventListener("click",this.onClickModuleList.bind(this)),this.availUList.addEventListener("click",this.onClickModuleList.bind(this));const n=this.node.getElementsByClassName("jp-Lmod-collectionButton");n["save-button"].addEventListener("click",L),n["restore-button"].addEventListener("click",this.restore.bind(this)),n["export-button"].addEventListener("click",j),this.searchInput.addEventListener("keyup",this.updateAvail.bind(this))}async onClickModuleList(t){const e=t.target;if("SPAN"==e.tagName)!async function(t){const e=(await m.show(t)).split("\n"),n=e.slice(3).join("\n").trim(),s=e[1].slice(0,-1);l.showDialog({title:t,body:new S(s,n),buttons:[l.Dialog.okButton()]})}(e.innerText);else if("BUTTON"==e.tagName){const n=t.target.closest("li").querySelector("span").innerText;"Load"==e.innerText?await async function(t){const e=await m.load([t]);null!=e&&l.showDialog({title:"Module warning",body:new S("Warning",e),buttons:[l.Dialog.okButton()]})}(n):"Unload"==e.innerText&&await m.unload([n]),this.update()}}update(){Promise.all([m.avail(),m.list()]).then((t=>{const e=new Set(t[0]),n=t[1],s=n.map((t=>p(t,"Unload")));this.loadedUList.innerText="",this.loadedUList.append(...s),n.map((t=>e.delete(t))),this.searchSource=Array.from(e),this.updateAvail(),function(t){for(let e in y)t.some((t=>t.toLowerCase().includes(e)))?v.hasOwnProperty(e)||(v[e]=f.add(y[e])):v.hasOwnProperty(e)&&(v[e].dispose(),delete v[e])}(n)})),b.refreshSpecs()}updateAvail(){const t=this.searchInput.value;this.availUList.innerText="";const e=this.searchSource.filter((e=>e.toUpperCase().includes(t.toUpperCase()))),n=e.map((t=>p(t,"Load")));this.availUList.append(...n),this.availHeader.innerText=`Available Modules (${e.length})`}restore(t){return l.showDialog({title:"Restore collection",body:new E,buttons:[l.Dialog.cancelButton(),l.Dialog.okButton({label:"Restore"})]}).then((t=>{if("Restore"===t.button.label){const e=t.value;m.restore(e).then((()=>this.update()))}}))}}class g{constructor(t){this.launcher_pins=t}add(t){let e=t.args.id.split(":")[1];this.launcher_pins.includes(e.toLowerCase())?f.add(t):y[e]=t}}const _={id:"jupyterlab_lmod",autoStart:!0,requires:[l.ICommandPalette,i.ILayoutRestorer,d.ILauncher],activate:function(t,e,n,s){const o=new w;f=s,b=t.serviceManager.kernelspecs,async function(t,e){let n=[];const s=await fetch(c.PageConfig.getBaseUrl()+"lmod/launcher-pins");s.ok?n=(await s.json()).launcher_pins.map((t=>t.toLowerCase())):console.log("jupyter-lmod: could not communicate with jupyter-lmod API.");let o=new g(n);h.default.activate(t,o,e)}(t,n),n.add(o,"lmod-sessions"),t.shell.add(o,"left",{rank:1e3}),o.update(),console.log("JupyterFrontEnd extension lmod is activated!")}};class C extends r.Widget{constructor(){let t=document.createElement("div"),e=document.createElement("label");e.innerHTML="Enter a new collection name:",t.appendChild(e);let n=document.createElement("input");n.placeholder="default",t.appendChild(n),super({node:t})}getValue(){return this.node.querySelector("input").value}}class E extends r.Widget{constructor(){let t=document.createElement("div"),e=document.createElement("label");e.innerHTML="Select a collection to restore :",t.appendChild(e);let n=document.createElement("select");m.savelist().then((t=>{t.map(((t,e)=>{let s=document.createElement("option");s.value=t,s.text=t,n.add(s)}))})),t.appendChild(n),super({node:t})}getValue(){return this.node.querySelector("select").value}}class S extends r.Widget{constructor(t,e){let n=document.createElement("div"),s=document.createElement("label");s.innerHTML=t,n.appendChild(s);let o=document.createElement("div");o.classList.add("jp-JSONEditor-host"),o.setAttribute("style","min-height:inherit;");let a=document.createElement("pre");a.setAttribute("style","margin:10px 10px; white-space:pre-wrap;"),a.innerHTML=e,o.appendChild(a),n.appendChild(o),super({node:n})}}e.default=_}}]);