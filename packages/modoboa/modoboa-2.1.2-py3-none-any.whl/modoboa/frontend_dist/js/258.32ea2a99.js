"use strict";(self["webpackChunkModoboa"]=self["webpackChunkModoboa"]||[]).push([[258],{6266:function(t,e,i){i.d(e,{Z:function(){return g}});var s=i(9559),a=i(9884),n=i(7808),r=i(2648),o=function(){var t=this,e=t._self._c;return e("validation-observer",{ref:"observer"},[t.form.pk?t._e():e(a.Z,{attrs:{label:t._f("translate")("Random address")},on:{input:t.update},model:{value:t.form.random,callback:function(e){t.$set(t.form,"random",e)},expression:"form.random"}}),t.form.random?t._e():e("validation-provider",{attrs:{name:"address",rules:"required"},scopedSlots:t._u([{key:"default",fn:function({errors:i}){return[e("label",{staticClass:"m-label"},[t._v(t._s(t.$gettext("Email address")))]),e("email-field",{ref:"address",attrs:{"error-messages":i,type:"email",outlined:"",dense:""},on:{input:t.update},model:{value:t.form.address,callback:function(e){t.$set(t.form,"address",e)},expression:"form.address"}})]}}],null,!1,2722540851)}),t.form.random?e("validation-provider",{attrs:{rules:"required"},scopedSlots:t._u([{key:"default",fn:function({errors:i}){return[e("label",{staticClass:"m-label"},[t._v(t._s(t.$gettext("Domain")))]),e(s.Z,{attrs:{items:t.domains,"error-messages":i,"item-text":"name","return-object":"",outlined:"",dense:""},on:{change:t.updateAddress,input:t.update},model:{value:t.form.domain,callback:function(e){t.$set(t.form,"domain",e)},expression:"form.domain"}})]}}],null,!1,1467360312)}):t._e(),e(a.Z,{attrs:{label:t._f("translate")("Enabled")},on:{input:t.update},model:{value:t.form.enabled,callback:function(e){t.$set(t.form,"enabled",e)},expression:"form.enabled"}}),e("label",{staticClass:"m-label"},[t._v(t._s(t.$gettext("Expire at")))]),e(n.Z,{attrs:{outlined:"",dense:""},on:{input:t.update},model:{value:t.form.expire,callback:function(e){t.$set(t.form,"expire",e)},expression:"form.expire"}}),e("label",{staticClass:"m-label"},[t._v(t._s(t.$gettext("Description")))]),e(r.Z,{attrs:{rows:"2",outlined:"",dense:""},on:{input:t.update},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1)},l=[],c=i(629),u=i(3853),d=i(422),h={components:{EmailField:d.Z},props:["value"],computed:{...(0,c.Se)({domains:"identities/domains"})},data(){return{form:{}}},methods:{reset(){this.form={}},updateAddress(t){u.Z.getRandomAddress().then((e=>{this.$set(this.form,"address",`${e.data.address}@${t.name}`),this.update()}))},update(){this.$emit("input",this.form)}},watch:{value:{handler(t){this.form=t?{...t}:{}},immediate:!0}}},m=h,p=i(1001),f=(0,p.Z)(m,o,l,!1,null,null,null),g=f.exports},7952:function(t,e,i){i.d(e,{Z:function(){return d}});var s=i(4127),a=function(){var t=this,e=t._self._c;return e("validation-observer",{ref:"observer"},[e("validation-provider",{attrs:{vid:"recipients"},scopedSlots:t._u([{key:"default",fn:function({errors:i}){return[e("email-field",{ref:"recipientField",attrs:{placeholder:t._f("translate")("Start typing a name here..."),hint:t._f("translate")("Alias(es) of this mailbox. To create a catchall alias, just enter the domain name (@domain.tld)."),"persistent-hint":"","allow-add":"","error-messages":i},on:{"domain-selected":t.addRecipient},model:{value:t.recipient,callback:function(e){t.recipient=e},expression:"recipient"}})]}}])}),t._l(t.recipients,(function(i,a){return e(s.Z,{key:a,staticClass:"mr-2 mt-2",attrs:{close:""},on:{"click:close":function(e){return t.removeRecipient(a)}}},[t._v(" "+t._s(i)+" ")])}))],2)},n=[],r=(i(7658),i(422)),o={props:["value"],components:{EmailField:r.Z},data(){return{recipient:"",recipients:[]}},methods:{reset(){this.recipient="",this.recipients=[]},async addRecipient(){this.recipients.push(this.recipient),this.$emit("input",this.recipients),this.$refs.recipientField.reset()},removeRecipient(t){this.recipients.splice(t,1),this.$emit("input",this.recipients)}},watch:{value:{handler:function(t){this.recipients=t?[...t]:[]},immediate:!0}}},l=o,c=i(1001),u=(0,c.Z)(l,a,n,!1,null,null,null),d=u.exports},8464:function(t,e,i){i.d(e,{Z:function(){return b}});var s=i(3694),a=i(4562),n=i(4145),r=i(4886),o=(i(7658),i(7808)),l=o.Z,c=i(4127),u=i(5352),d=i(4101),h=i(1767),m=l.extend({name:"v-file-input",model:{prop:"value",event:"change"},props:{chips:Boolean,clearable:{type:Boolean,default:!0},counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},hideInput:Boolean,multiple:Boolean,placeholder:String,prependIcon:{type:String,default:"$file"},readonly:{type:Boolean,default:!1},showSize:{type:[Boolean,Number],default:!1,validator:t=>"boolean"===typeof t||[1e3,1024].includes(t)},smallChips:Boolean,truncateLength:{type:[Number,String],default:22},type:{type:String,default:"file"},value:{default:void 0,validator:t=>(0,u.TI)(t).every((t=>null!=t&&"object"===typeof t))}},computed:{classes(){return{...l.options.computed.classes.call(this),"v-file-input":!0}},computedCounterValue(){const t=this.multiple&&this.lazyValue?this.lazyValue.length:this.lazyValue instanceof File?1:0;if(!this.showSize)return this.$vuetify.lang.t(this.counterString,t);const e=this.internalArrayValue.reduce(((t,{size:e=0})=>t+e),0);return this.$vuetify.lang.t(this.counterSizeString,t,(0,u.XE)(e,1024===this.base))},internalArrayValue(){return(0,u.TI)(this.internalValue)},internalValue:{get(){return this.lazyValue},set(t){this.lazyValue=t,this.$emit("change",this.lazyValue)}},isDirty(){return this.internalArrayValue.length>0},isLabelActive(){return this.isDirty},text(){return this.isDirty||!this.persistentPlaceholder&&!this.isFocused&&this.hasLabel?this.internalArrayValue.map((t=>{const{name:e="",size:i=0}=t,s=this.truncateText(e);return this.showSize?`${s} (${(0,u.XE)(i,1024===this.base)})`:s})):[this.placeholder]},base(){return"boolean"!==typeof this.showSize?this.showSize:void 0},hasChips(){return this.chips||this.smallChips}},watch:{readonly:{handler(t){!0===t&&(0,d.N6)("readonly is not supported on <v-file-input>",this)},immediate:!0},value(t){const e=this.multiple?t:t?[t]:[];(0,u.vZ)(e,this.$refs.input.files)||(this.$refs.input.value="")}},methods:{clearableCallback(){this.internalValue=this.multiple?[]:null,this.$refs.input.value=""},genChips(){return this.isDirty?this.text.map(((t,e)=>this.$createElement(c.Z,{props:{small:this.smallChips},on:{"click:close":()=>{const t=this.internalValue;t.splice(e,1),this.internalValue=t}}},[t]))):[]},genControl(){const t=l.options.methods.genControl.call(this);return this.hideInput&&(t.data.style=(0,h.y0)(t.data.style,{display:"none"})),t},genInput(){const t=l.options.methods.genInput.call(this);return t.data.attrs.multiple=this.multiple,delete t.data.domProps.value,delete t.data.on.input,t.data.on.change=this.onInput,[this.genSelections(),t]},genPrependSlot(){if(!this.prependIcon)return null;const t=this.genIcon("prepend",(()=>{this.$refs.input.click()}));return this.genSlot("prepend","outer",[t])},genSelectionText(){const t=this.text.length;return t<2?this.text:this.showSize&&!this.counter?[this.computedCounterValue]:[this.$vuetify.lang.t(this.counterString,t)]},genSelections(){const t=[];return this.isDirty&&this.$scopedSlots.selection?this.internalArrayValue.forEach(((e,i)=>{this.$scopedSlots.selection&&t.push(this.$scopedSlots.selection({text:this.text[i],file:e,index:i}))})):t.push(this.hasChips&&this.isDirty?this.genChips():this.genSelectionText()),this.$createElement("div",{staticClass:"v-file-input__text",class:{"v-file-input__text--placeholder":this.placeholder&&!this.isDirty,"v-file-input__text--chips":this.hasChips&&!this.$scopedSlots.selection}},t)},genTextFieldSlot(){const t=l.options.methods.genTextFieldSlot.call(this);return t.data.on={...t.data.on||{},click:()=>this.$refs.input.click()},t},onInput(t){const e=[...t.target.files||[]];this.internalValue=this.multiple?e:e[0],this.initialValue=this.internalValue},onKeyDown(t){this.$emit("keydown",t)},truncateText(t){if(t.length<Number(this.truncateLength))return t;const e=Math.floor((Number(this.truncateLength)-1)/2);return`${t.slice(0,e)}â€¦${t.slice(t.length-e)}`}}}),p=i(3687),f=i(9884),g=function(){var t=this,e=t._self._c;return e(n.Z,[e(r.EB,[e("span",{staticClass:"headline"},[t._v(t._s(t.title))])]),e(r.ZB,[e(s.Z,{attrs:{text:"",type:"info"}},[e("translate",{attrs:{tag:"p"}},[t._v("Provide a CSV file where lines respect one of the following formats:")]),t._t("help"),e("translate",{attrs:{tag:"p"}},[t._v("The first element of each line is mandatory and must be equal to one of the previous values.")]),e("translate",{attrs:{tag:"p"}},[t._v("You can use a different character as separator.")])],2),e("validation-observer",{ref:"observer"},[e("validation-provider",{attrs:{name:"name",rules:"required"},scopedSlots:t._u([{key:"default",fn:function({errors:i}){return[e("label",{staticClass:"m-label"},[e("translate",[t._v("Select file")])],1),e(m,{attrs:{accept:"text/csv","error-messages":i,"truncate-length":"15",outlined:"",dense:""},model:{value:t.form.sourcefile,callback:function(e){t.$set(t.form,"sourcefile",e)},expression:"form.sourcefile"}})]}}])}),e("label",{staticClass:"m-label"},[e("translate",[t._v("Separator")])],1),e(o.Z,{attrs:{"error-messages":t.errors,outlined:"",dense:""},model:{value:t.form.sepchar,callback:function(e){t.$set(t.form,"sepchar",e)},expression:"form.sepchar"}}),e(f.Z,{attrs:{label:t._f("translate")("Continue on error"),color:"primary",dense:"",hint:t._f("translate")("Don't treat duplicated objects as errors"),"persistent-hint":""},model:{value:t.form.continue_if_exists,callback:function(e){t.$set(t.form,"continue_if_exists",e)},expression:"form.continue_if_exists"}}),t._t("extraFields",null,{form:t.form})],2)],1),e(r.h7,[e(p.Z),e(a.Z,{on:{click:t.close}},[e("translate",[t._v("Close")])],1),e(a.Z,{attrs:{color:"primary"},on:{click:t.submit}},[e("translate",[t._v("Import")])],1)],1)],1)},v=[],x={props:{helpText:String,title:String},data(){return{form:{}}},methods:{close(){this.form={},this.$refs.observer.reset(),this.$emit("close")},async submit(){const t=await this.$refs.observer.validate();if(!t)return;const e=new FormData;e.append("sourcefile",this.form.sourcefile),this.form.sepchar&&e.append("sepchar",this.form.sepchar),this.form.continue_if_exists&&e.append("continue_if_exists",this.form.continue_if_exists),this.$emit("beforeSubmit",e),this.$emit("submit",e)}}},$=x,y=i(1001),_=(0,y.Z)($,g,v,!1,null,null,null),b=_.exports},6196:function(t,e,i){i.r(e),i.d(e,{default:function(){return pt}});var s=i(4562),a=i(4061),n=i(4324),r=i(5808),o=i(4525),l=i(9378),c=i(4528),u=i(3687),d=i(9884),h=i(6313),m=i(7953),p=function(){var t=this,e=t._self._c;return e("div",[e(h.Z,{attrs:{flat:""}},[e(m.qW,[e("translate",[t._v("Identities")])],1),e(u.Z),e(s.Z,{staticClass:"mr-2",attrs:{title:t._f("translate")("Import accounts and aliases from CSV file")},on:{click:function(e){t.showImportForm=!0}}},[e(n.Z,[t._v("mdi-file-import-outline")])],1),e(s.Z,{staticClass:"mr-2",attrs:{title:t._f("translate")("Export accounts and aliases to CSV")},on:{click:t.exportIdentities}},[e(n.Z,[t._v("mdi-file-export-outline")])],1),e(c.Z,{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function({on:i,attrs:a}){return[e(s.Z,t._g(t._b({attrs:{color:"primary"}},"v-btn",a,!1),i),[e(n.Z,{attrs:{left:""}},[t._v("mdi-plus")]),e("translate",[t._v("New")])],1)]}}])},[e(r.Z,{attrs:{dense:""}},[e(o.Z,{on:{click:function(e){t.showCreationWizard=!0}}},[e(l.V9,[e("translate",[t._v("Account")])],1)],1),e(o.Z,{on:{click:function(e){t.showAliasCreationWizard=!0}}},[e(l.V9,[e("translate",[t._v("Alias")])],1)],1)],1)],1)],1),e("identity-list",{ref:"identities"}),e(a.Z,{attrs:{fullscreen:"",scrollable:"",transition:"dialog-bottom-transition",persistent:""},model:{value:t.showCreationWizard,callback:function(e){t.showCreationWizard=e},expression:"showCreationWizard"}},[e("account-creation-form",{on:{close:t.closeCreationWizard,created:t.updateIdentities}})],1),e(a.Z,{attrs:{fullscreen:"",scrollable:"",transition:"dialog-bottom-transition",persistent:""},model:{value:t.showAliasCreationWizard,callback:function(e){t.showAliasCreationWizard=e},expression:"showAliasCreationWizard"}},[e("alias-creation-form",{on:{close:t.closeAliasWizard,created:t.updateIdentities}})],1),e(a.Z,{attrs:{persistent:"","max-width":"800px"},model:{value:t.showImportForm,callback:function(e){t.showImportForm=e},expression:"showImportForm"}},[e("import-form",{ref:"importForm",attrs:{title:t._f("translate")("Import identities")},on:{beforeSubmit:t.prepareData,submit:t.importIdentities,close:function(e){t.showImportForm=!1}},scopedSlots:t._u([{key:"help",fn:function(){return[e("ul",[e("li",[e("em",[t._v("account; loginname; password; first name; last name; enabled; group; address; quota; [, domain, ...]")])]),e("li",[e("em",[t._v("alias; address; enabled; recipient; recipient; ...")])])])]},proxy:!0},{key:"extraFields",fn:function({form:i}){return[e(d.Z,{attrs:{label:t._f("translate")("Crypt passwords"),color:"primary",dense:"",hint:t._f("translate")("Check this option if passwords contained in your file are not crypted"),"persistent-hint":""},model:{value:i.crypt_passwords,callback:function(e){t.$set(i,"crypt_passwords",e)},expression:"form.crypt_passwords"}})]}}])})],1)],1)},f=[],g=i(266),v=i(1713),x=function(){var t=this,e=t._self._c;return e("creation-form",{ref:"form",attrs:{title:t._f("translate")("New account"),steps:t.steps,"form-getter":t.getForm,"form-observer-getter":t.getObserver,"validate-object":t.validateAccount,"summary-sections":t.summarySections},on:{close:t.close,create:t.submit},scopedSlots:t._u([{key:"form.role",fn:function({step:i}){return[e("account-role-form",{ref:`form_${i}`,attrs:{account:t.account},model:{value:t.account.role,callback:function(e){t.$set(t.account,"role",e)},expression:"account.role"}})]}},{key:"form.identification",fn:function({step:i}){return[i>=2?e("account-general-form",{ref:`form_${i}`,model:{value:t.account,callback:function(e){t.account=e},expression:"account"}}):t._e()]}},{key:"form.mailbox",fn:function({step:i}){return[e("account-mailbox-form",{ref:`form_${i}`,model:{value:t.account,callback:function(e){t.account=e},expression:"account"}})]}},{key:"form.aliases",fn:function({step:i}){return[i>=4?e("account-alias-form",{ref:`form_${i}`,model:{value:t.account.aliases,callback:function(e){t.$set(t.account,"aliases",e)},expression:"account.aliases"}}):t._e()]}},{key:"item.random_password",fn:function({item:i}){return[i.value?[e(g.Z,{staticClass:"highligth white--text",attrs:{cols:"12"}},[e(v.Z,[e(g.Z,[e("span",[t._v(t._s(i.key))])]),"yesno"===i.type?e(g.Z,{staticClass:"text-right"},[t._v(" "+t._s(t._f("yesno")(i.value))+" ")]):t._e()],1),e(v.Z,[e(g.Z,{staticClass:"text-right py-1"},[t._v(" "+t._s(t.account.password)+" "),e(s.Z,{attrs:{icon:"",color:"white",title:t._f("translate")("Copy to clipboard")},on:{click:t.copyPassword}},[e(n.Z,[t._v("mdi-clipboard-multiple-outline")])],1)],1)],1)],1)]:[e(g.Z,[e("span",{staticClass:"grey--text"},[t._v(t._s(i.key))])]),"yesno"===i.type?e(g.Z,{staticClass:"text-right"},[t._v(t._s(t._f("yesno")(i.value)))]):t._e()]]}}])})},$=[],y=i(1589),_=i(9066),b=i(4127),k=function(){var t=this,e=t._self._c;return e("validation-observer",{ref:"observer"},[e("validation-provider",{attrs:{vid:"alias"},scopedSlots:t._u([{key:"default",fn:function({errors:i}){return[e("email-field",{ref:"aliasField",attrs:{placeholder:t._f("translate")("Start typing a name here..."),hint:t._f("translate")("Alias(es) of this mailbox. To create a catchall alias, just enter the domain name (@domain.tld)."),"persistent-hint":"","error-messages":i},on:{"domain-selected":t.addAlias},model:{value:t.currentAlias,callback:function(e){t.currentAlias=e},expression:"currentAlias"}})]}}])}),t._l(t.aliases,(function(i,s){return e(b.Z,{key:s,staticClass:"mr-2 mt-2",attrs:{close:""},on:{"click:close":function(e){return t.removeAlias(s)}}},[t._v(" "+t._s(i)+" ")])}))],2)},Z=[],w=(i(7658),i(422)),A={props:["value"],components:{EmailField:w.Z},data(){return{currentAlias:"",aliases:[]}},methods:{reset(){this.currentAlias="",this.aliases=[]},async addAlias(){try{await _.Z.validate({aliases:[this.currentAlias]}),this.aliases.push(this.currentAlias),this.$refs.aliasField.reset()}catch(t){let e=null;t.response.data.aliases?e=t.response.data.aliases:t.response.data.non_field_errors&&(e=t.response.data.non_field_errors),this.$refs.observer.setErrors({alias:e})}},removeAlias(t){this.aliases.splice(t,1),this.update()},update(){this.$emit("input",this.aliases)}},mounted(){this.aliases=[...this.value]}},I=A,C=i(1001),S=(0,C.Z)(I,k,Z,!1,null,null,null),F=S.exports,z=i(1349),D=i(3153),R=i(2690),V=i(173),E={components:{AccountAliasForm:F,AccountGeneralForm:z.Z,AccountMailboxForm:D.Z,AccountRoleForm:R.Z,CreationForm:V.Z},computed:{summarySections(){const t=[{title:this.$gettext("Role"),items:[{key:this.$gettext("Role"),value:this.account.role}]},{title:this.$gettext("Identification"),items:[{key:this.$gettext("Username"),value:this.account.username},{key:this.$gettext("First name"),value:this.account.first_name},{key:this.$gettext("Last name"),value:this.account.last_name},{name:"random_password",key:this.$gettext("Random password"),value:this.account.random_password,type:"yesno"},{key:this.$gettext("Enabled"),value:this.account.is_active,type:"yesno"}]},{title:this.$gettext("Mailbox"),items:[{key:this.$gettext("Email"),value:this.account.mailbox.full_address},{key:this.$gettext("Quota"),value:this.account.mailbox.use_domain_quota?this.$gettext("Domain default value"):this.account.mailbox.quota},{key:this.$gettext("Message sending limit"),value:this.account.mailbox.message_limit}]},{title:this.$gettext("Aliases"),items:[{key:this.$gettext("Aliases"),value:this.account.aliases,type:"list"}]}];return t}},data(){return{account:this.getInitialForm(),steps:[{name:"role",title:this.$gettext("Role")},{name:"identification",title:this.$gettext("Identification")},{name:"mailbox",title:this.$gettext("Mailbox")},{name:"aliases",title:this.$gettext("Aliases")}]}},methods:{copyPassword(){navigator.clipboard.writeText(this.account.password).then((()=>{y.$.$emit("notification",{msg:this.$gettext("Password copied to clipboard")})}))},getInitialForm(){return{aliases:[],is_active:!0,role:"SimpleUsers",mailbox:{use_domain_quota:!0},random_password:!0}},getForm(t){return this.$refs[`form_${t}`]},getObserver(t){return this.$refs[`form_${t}`].$refs.observer},validateAccount(){return""===this.account.mailbox.message_limit&&this.$set(this.account.mailbox,"message_limit",void 0),_.Z.validate(this.account)},close(){this.account=this.getInitialForm(),this.$refs.form.resetForm(),this.$emit("close")},submit(){const t={...this.account};"SuperAdmins"===this.account.role&&-1===this.account.username.indexOf("@")&&delete t.mailbox,_.Z.create(t).then((()=>{y.$.$emit("notification",{msg:this.$gettext("Account created")}),this.$emit("created"),this.close()}))}},mounted(){this.$store.dispatch("identities/fetchDomains")}},T=E,L=(0,C.Z)(T,x,$,!1,null,null,null),W=L.exports,N=function(){var t=this,e=t._self._c;return e("creation-form",{ref:"form",attrs:{title:t._f("translate")("New alias"),steps:t.steps,"form-getter":t.getForm,"form-observer-getter":t.getObserver,"validate-object":t.validateAlias,"summary-sections":t.summarySections},on:{close:t.close,create:t.submit},scopedSlots:t._u([{key:"form.general",fn:function({step:i}){return[e("alias-general-form",{ref:`form_${i}`,model:{value:t.alias,callback:function(e){t.alias=e},expression:"alias"}})]}},{key:"form.recipients",fn:function({step:i}){return[e("alias-recipient-form",{ref:`form_${i}`,model:{value:t.alias.recipients,callback:function(e){t.$set(t.alias,"recipients",e)},expression:"alias.recipients"}})]}}])})},B=[],j=i(3853),M=i(6266),G=i(7952),H={components:{AliasGeneralForm:M.Z,AliasRecipientForm:G.Z,CreationForm:V.Z},computed:{summarySections(){const t=[{title:this.$gettext("General"),items:[{key:this.$gettext("Random address"),value:this.alias.random,type:"yesno"},{key:this.$gettext("Address"),value:this.alias.address}]}];return void 0!==this.alias.expire_at&&t[0].items.push({key:this.$gettext("Expire at"),value:this.alias.expire_at}),void 0!==this.alias.description&&t[0].items.push({key:this.$gettext("Description"),value:this.alias.description}),t.push({title:this.$gettext("Recipients"),items:[{key:this.$gettext("Recipients"),value:this.alias.recipients.join(", ")}]}),t}},data(){return{alias:this.getInitialForm(),steps:[{name:"general",title:this.$gettext("General")},{name:"recipients",title:this.$gettext("Recipients")}]}},methods:{close(){this.alias=this.getInitialForm(),this.$refs.form.resetForm(),this.$emit("close")},getInitialForm(){return{random:!1,enabled:!0,recipients:[]}},getForm(t){return this.$refs[`form_${t}`]},getObserver(t){return this.$refs[`form_${t}`].$refs.observer},validateAlias(){const t={...this.alias};return 0===t.recipients.length&&delete t.recipients,j.Z.validate(t)},submit(){j.Z.create(this.alias).then((t=>{y.$.$emit("notification",{msg:this.$gettext("Alias created")}),this.$emit("created"),this.close()}))}},mounted(){this.$store.dispatch("identities/fetchDomains")}},O=H,P=(0,C.Z)(O,N,B,!1,null,null,null),U=P.exports,q=i(2201);const Y="identities";var K={getAll(){return q.Z.get(`${Y}/`)},exportAll(){return q.Z.get(`/${Y}/export/`)},importFromCSV(t){return q.Z.post(`/${Y}/import/`,t,{headers:{"Content-Type":"multipart/form-data"}})}},X=i(4145),Q=i(3486),J=i(5151),tt=i(7808),et=function(){var t=this,e=t._self._c;return e(X.Z,{staticClass:"mt-6"},[e(h.Z,{attrs:{flat:""}},[e(c.Z,{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function({on:i,attrs:a}){return[e(s.Z,t._g(t._b({attrs:{small:""}},"v-btn",a,!1),i),[e("translate",[t._v("Actions")]),t._v(" "),e(n.Z,{attrs:{right:""}},[t._v("mdi-chevron-down")])],1)]}}])},[e(r.Z,{attrs:{dense:""}},[e("menu-items",{attrs:{items:t.getActionMenuItems()}})],1)],1),e(u.Z),e(tt.Z,{attrs:{"prepend-inner-icon":"mdi-magnify",placeholder:"Search",filled:"",outlined:"",dense:"","hide-details":""},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),e(J.Z,{staticClass:"elevation-1",attrs:{headers:t.headers,items:t.identities,search:t.search,loading:t.loading,"item-key":"identity","show-select":""},scopedSlots:t._u([{key:"item.identity",fn:function({item:i}){return["account"===i.type?[e("router-link",{attrs:{to:{name:"AccountDetail",params:{id:i.pk}}}},[t._v(" "+t._s(i.identity)+" ")])]:[e("router-link",{attrs:{to:{name:"AliasDetail",params:{id:i.pk}}}},[t._v(" "+t._s(i.identity)+" ")])]]}},{key:"item.tags",fn:function({item:i}){return t._l(i.tags,(function(i,s){return e(b.Z,{key:i.name,class:s>0?"ml-2":"",attrs:{color:"idt"!==i.type?"primary":"default",small:""}},[t._v(" "+t._s(i.label)+" ")])}))}},{key:"item.actions",fn:function({item:i}){return[0!==i.possible_actions.length?[e(n.Z,{attrs:{size:"2.5em",color:"blue"}},[t._v("mdi-circle-small")])]:t._e(),e(c.Z,{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function({on:i,attrs:a}){return[e(s.Z,t._g(t._b({attrs:{icon:""}},"v-btn",a,!1),i),[e(n.Z,[t._v("mdi-dots-horizontal")])],1)]}}],null,!0)},[e("menu-items",{attrs:{items:t.getMenuItems(i),object:i}})],1)]}}]),model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}}),e("confirm-dialog",{ref:"confirmAlias"}),e("confirm-dialog",{ref:"confirmAccount"},[e(Q.Z,{attrs:{label:t._f("translate")("Do not delete account folder"),"hide-details":""},model:{value:t.keepAccountFolder,callback:function(e){t.keepAccountFolder=e},expression:"keepAccountFolder"}})],1)],1)},it=[],st=i(9958),at=i(8658),nt={components:{ConfirmDialog:st.Z,MenuItems:at.Z},data(){return{headers:[{text:this.$gettext("Name"),value:"identity"},{text:this.$gettext("Fullname/recipient"),value:"name_or_rcpt"},{text:this.$gettext("Tags"),value:"tags"},{text:this.$gettext("Actions"),value:"actions",sortable:!1,align:"right"}],identities:[],keepAccountFolder:!1,loading:!0,search:"",selected:[]}},methods:{sleep(t){return new Promise((e=>setTimeout(e,t)))},async deleteAlias(t,e=!0){if(e){const e=await this.$refs.confirmAlias.open(this.$gettext("Warning"),this.$gettext("Do you really want to delete the alias %{ alias }?",{alias:t.identity}),{color:"error",cancelLabel:this.$gettext("No"),agreeLabel:this.$gettext("Yes")});if(!e)return}j.Z["delete"](t.pk).then((()=>{e&&(this.fetchIdentities(),y.$.$emit("notification",{msg:this.$gettext("Alias deleted")}))}))},async deleteAccount(t,e=!0){if(e){const e=await this.$refs.confirmAccount.open(this.$gettext("Warning"),this.$gettextInterpolate("Do you really want to delete the account %{ account }?",{account:t.identity}),{color:"error",cancelLabel:this.$gettext("No"),agreeLabel:this.$gettext("Yes")});if(!e)return}const i={keepdir:this.keepAccountFolder};_.Z["delete"](t.pk,i).then((()=>{this.keepAccountFolder=!1,e&&(y.$.$emit("notification",{msg:this.$gettext("Account deleted")}),this.fetchIdentities())})).catch((t=>{y.$.$emit("notification",{msg:t.response.data,type:"error"})}))},async deleteIdentities(){if(0===this.selected.length)return;const t=await this.$refs.confirmAlias.open(this.$gettext("Warning"),this.$gettext("Do you really want to delete the selected identities?"),{color:"error",cancelLabel:this.$gettext("No"),agreeLabel:this.$gettext("Yes")});if(t){for(const t of this.selected)"account"===t.type?this.deleteAccount(t,!1):"alias"===t.type&&this.deleteAlias(t,!1),await this.sleep(100);y.$.$emit("notification",{msg:this.$gettext("Identities deleted")}),this.fetchIdentities()}},editAccount(t){this.$router.push({name:"AccountEdit",params:{id:t.pk}})},editAlias(t){this.$router.push({name:"AliasEdit",params:{id:t.pk}})},fetchIdentities(){K.getAll().then((t=>{this.identities=t.data,this.selected=[],this.loading=!1}))},downloadFile(t){q.Z.get(t.url).then((e=>{const i=window.URL.createObjectURL(new Blob([e.data],{type:t.content_type})),s=document.createElement("a");s.style.display="none",s.href=i,s.download=t.filename,document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(s.href),document.body.removeChild(s)}))},getMenuItems(t){const e=[];return"account"===t.type?(t.possible_actions.forEach((t=>{e.push({label:t.label,icon:t.icon,onClick:()=>{"download"===t.type&&this.downloadFile(t),this.fetchIdentities()}})})),e.push({label:this.$gettext("Edit"),icon:"mdi-circle-edit-outline",onClick:this.editAccount}),e.push({label:this.$gettext("Delete"),icon:"mdi-delete-outline",onClick:this.deleteAccount,color:"red"})):"alias"===t.type&&(e.push({label:this.$gettext("Edit"),icon:"mdi-circle-edit-outline",onClick:this.editAlias}),e.push({label:this.$gettext("Delete"),icon:"mdi-delete-outline",onClick:this.deleteAlias,color:"red"})),e},getActionMenuItems(){const t=[];return this.selected.length>0&&t.push({label:this.$gettext("Delete"),icon:"mdi-delete-outline",onClick:this.deleteIdentities,color:"red"}),t.push({label:"Reload",icon:"mdi-reload",onClick:this.fetchIdentities}),t}},mounted(){this.fetchIdentities()}},rt=nt,ot=(0,C.Z)(rt,et,it,!1,null,null,null),lt=ot.exports,ct=i(1202),ut=i(8464),dt={mixins:[ct.d],components:{AccountCreationForm:W,AliasCreationForm:U,IdentityList:lt,ImportForm:ut.Z},data(){return{showAliasCreationWizard:!1,showCreationWizard:!1,showImportForm:!1}},methods:{closeAliasWizard(){this.showAliasCreationWizard=!1},closeCreationWizard(){this.showCreationWizard=!1},updateIdentities(){this.$refs.identities.fetchIdentities()},exportIdentities(){K.exportAll().then((t=>{this.exportContent(t.data,"identities")}))},prepareData(t){t.append("crypt_passwords",this.form.crypt_passwords)},importIdentities(t){this.importContent(K,t)}}},ht=dt,mt=(0,C.Z)(ht,p,f,!1,null,"50c92d37",null),pt=mt.exports},3486:function(t,e,i){i.d(e,{Z:function(){return r}});i(7393);var s=i(2240),a=i(573),n=i(596),r=n.Z.extend({name:"v-checkbox",props:{indeterminate:Boolean,indeterminateIcon:{type:String,default:"$checkboxIndeterminate"},offIcon:{type:String,default:"$checkboxOff"},onIcon:{type:String,default:"$checkboxOn"}},data(){return{inputIndeterminate:this.indeterminate}},computed:{classes(){return{...a.Z.options.computed.classes.call(this),"v-input--selection-controls":!0,"v-input--checkbox":!0,"v-input--indeterminate":this.inputIndeterminate}},computedIcon(){return this.inputIndeterminate?this.indeterminateIcon:this.isActive?this.onIcon:this.offIcon},validationState(){if(!this.isDisabled||this.inputIndeterminate)return this.hasError&&this.shouldValidate?"error":this.hasSuccess?"success":null!==this.hasColor?this.computedColor:void 0}},watch:{indeterminate(t){this.$nextTick((()=>this.inputIndeterminate=t))},inputIndeterminate(t){this.$emit("update:indeterminate",t)},isActive(){this.indeterminate&&(this.inputIndeterminate=!1)}},methods:{genCheckbox(){const{title:t,...e}=this.attrs$;return this.$createElement("div",{staticClass:"v-input--selection-controls__input"},[this.$createElement(s.Z,this.setTextColor(this.validationState,{props:{dense:this.dense,dark:this.dark,light:this.light}}),this.computedIcon),this.genInput("checkbox",{...e,"aria-checked":this.inputIndeterminate?"mixed":this.isActive.toString()}),this.genRipple(this.setTextColor(this.rippleState))])},genDefaultSlot(){return[this.genCheckbox(),this.genLabel()]}}})},2648:function(t,e,i){i.d(e,{Z:function(){return r}});var s=i(7808),a=i(7678);const n=(0,a.Z)(s.Z);var r=n.extend({name:"v-textarea",props:{autoGrow:Boolean,noResize:Boolean,rowHeight:{type:[Number,String],default:24,validator:t=>!isNaN(parseFloat(t))},rows:{type:[Number,String],default:5,validator:t=>!isNaN(parseInt(t,10))}},computed:{classes(){return{"v-textarea":!0,"v-textarea--auto-grow":this.autoGrow,"v-textarea--no-resize":this.noResizeHandle,...s.Z.options.computed.classes.call(this)}},noResizeHandle(){return this.noResize||this.autoGrow}},watch:{autoGrow(t){this.$nextTick((()=>{var e;t?this.calculateInputHeight():null===(e=this.$refs.input)||void 0===e||e.style.removeProperty("height")}))},lazyValue(){this.autoGrow&&this.$nextTick(this.calculateInputHeight)},rowHeight(){this.autoGrow&&this.$nextTick(this.calculateInputHeight)}},mounted(){setTimeout((()=>{this.autoGrow&&this.calculateInputHeight()}),0)},methods:{calculateInputHeight(){const t=this.$refs.input;if(!t)return;t.style.height="0";const e=t.scrollHeight,i=parseInt(this.rows,10)*parseFloat(this.rowHeight);t.style.height=Math.max(i,e)+"px"},genInput(){const t=s.Z.options.methods.genInput.call(this);return t.tag="textarea",delete t.data.attrs.type,t.data.attrs.rows=this.rows,t},onInput(t){s.Z.options.methods.onInput.call(this,t),this.autoGrow&&this.calculateInputHeight()},onKeyDown(t){this.isFocused&&13===t.keyCode&&t.stopPropagation(),this.$emit("keydown",t)}}})},3853:function(t,e,i){var s=i(2201);const a="aliases";e["Z"]={get(t){return s.Z.get(`${a}/${t}/`)},getRandomAddress(){return s.Z.get(`${a}/random_address/`)},validate(t){return s.Z.post(`${a}/validate/`,t)},create(t){return s.Z.post(`${a}/`,t)},patch(t,e){return s.Z.patch(`${a}/${t}/`,e)},delete(t){return s.Z["delete"](`${a}/${t}/`)}}},1202:function(t,e,i){i.d(e,{d:function(){return a}});var s=i(1589);const a={methods:{exportContent(t,e){const i=new Blob([t],{type:"text/csv"}),s=document.createElement("a");s.href=URL.createObjectURL(i),s.download=`modoboa-${e}.csv`,s.click(),URL.revokeObjectURL(s.href)},importContent(t,e){t.importFromCSV(e).then((t=>{t.data.status?(s.$.$emit("notification",{msg:t.data.message}),this.$refs.importForm.close()):s.$.$emit("notification",{msg:t.data.message,type:"error"})}))}}}}}]);
//# sourceMappingURL=258.32ea2a99.js.map