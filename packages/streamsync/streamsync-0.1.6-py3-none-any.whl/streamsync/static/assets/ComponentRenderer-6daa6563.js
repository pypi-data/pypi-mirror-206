import{K as R,d as J,i as M,b as I,q as ne,c as h,o as $,e as V,f as u,t as T,u as F,l as z,_ as w,P as oe,r as N,B as K,Q as D,R as S,S as se,D as ae,w as H,v as X,h as ce,F as le,y as re,n as U,p as q,j as G,k as ie,s as de,x as ue,O as pe}from"./index-3c1dd388.js";function Q(l){const f=/[\\]?@{([^}]*)}/g;function y(n){var _,a;const s={};for(let t=0;t<n.length-1;t++){const e=n[t],{componentId:c}=e,{type:o}=l.getComponentById(c);if(o!=="repeater"||t+1>=n.length)continue;const m=n.slice(0,t+1),P=n.slice(0,t+2),{instanceNumber:b}=P.at(-1),x=p(m,"repeaterObject");if(!x)continue;const B=Object.entries(x),j=p(m,"keyVariable"),O=p(m,"valueVariable");s[j]=(_=B[b])==null?void 0:_[0],s[O]=(a=B[b])==null?void 0:a[1]}return s}function i(n,s){if(n==null)return"";const _=y(s);return n.replace(f,(t,e)=>{if(t.charAt(0)=="\\")return t.substring(1);const c=e.trim();if(!c)return"";const o=l.evaluateExpression(c,_);return typeof o>"u"?"":typeof o=="object"?JSON.stringify(o):o})}function d(n){const{componentId:s}=n.at(-1),_=l.getComponentById(s);if(!_)return;const a={},{fields:t}=l.getComponentDefinition(_.type);if(t)return Object.keys(t).forEach(e=>{a[e]=p(n,e)}),a}function p(n,s){var P;const{componentId:_}=n.at(-1),a=l.getComponentById(_),{fields:t}=l.getComponentDefinition(a.type),e=(P=a.content)==null?void 0:P[s],c=t[s].default,o=i(e,n),m=t[s].type;if(m==R.Object||m==R.KeyValue){if(!o)return JSON.parse(c)??null;if(typeof o!="string")return o;let b;try{b=JSON.parse(o)}catch{return JSON.parse(c)??null}return b}else if(m==R.Number){const b=parseFloat(o);return typeof b===void 0||Number.isNaN(b)?parseFloat(c??"0"):b}else return m==R.IdKey?e:typeof o>"u"||o===null||o===""?c??"":o}return{getEvaluatedFields:d}}const ve={class:"ChildlessPlaceholder"},fe={class:"content"},_e={class:"title"},me={key:0,class:"message"},ge=J({__name:"ChildlessPlaceholder",props:{componentId:null},setup(l){const f=l,y=10,i=M(I.core),{componentId:d}=ne(f),p=h(()=>i.getComponentById(d.value)),n=h(()=>i.getComponentDefinition(p.value.type)),s=(a,t)=>{const c=a.map(m=>i.getComponentDefinition(m)).map(m=>m==null?void 0:m.name);return`${c.slice(0,-1).join(", ")} ${c.length>1?t:""} ${c.at(-1)}`},_=h(()=>{const a=i.getContainableTypes(d.value);let t;return a.length<=y&&(t=`You can add ${s(a,"and")} components`),t});return(a,t)=>($(),V("div",ve,[u("div",fe,[u("div",_e,[u("h2",null,"Empty "+T(F(n).name),1)]),F(_)?($(),V("div",me,T(F(_)),1)):z("",!0)])]))}});const he=w(ge,[["__scopeId","data-v-b958fd6f"]]),ye=l=>()=>D("div",`Component type ${l} not supported.`),Ce={props:["componentId","instancePath","instanceData"],setup(l){const f=M(I.core),y=M(I.builderManager),i=l.componentId,d=h(()=>f.getComponentById(i)),p=oe[d.value.type];if(!p)return ye(d.value.type);const n=l.instancePath,s=l.instanceData,_=Q(f),a=h(()=>_.getEvaluatedFields(n)),t=h(()=>f.getComponents(i,!0)),e=h(()=>!!y&&y.getMode()!="preview"),c=()=>{if(!(t.value.length>0))return D(he,{componentId:d.value.id})},o=(r,v=0)=>D(Y,{componentId:r,key:`${r}:${v}`,instancePath:[...n,{componentId:r,instanceNumber:v}],instanceData:[...s,N(null)]}),m=(r=0,v=()=>!0,g=!1)=>{const C=E=>D("div",{"data-streamsync-slot-of-id":i,"data-streamsync-position":E}),k=e.value&&!g,L=t.value.filter(v).map((E,W)=>[o(E.id,r),...k?[C(W+1)]:[]]);return[...k?[C(0)]:[]].concat(L.flat())};S(I.evaluatedFields,a),S(I.componentId,i),S(I.isBeingEdited,e),S(I.instancePath,n),S(I.instanceData,s),S(I.renderProxiedComponent,o),S(I.getChildrenVNodes,m);const b={"data-streamsync-id":i,"data-streamsync-instance-path":(r=>r.map(v=>`${v.componentId}:${v.instanceNumber}`).join(","))(n)},x=N(!1);K(()=>(y==null?void 0:y.getSelectedId())==i,r=>{x.value=r}),K(a,()=>{x.value=!1});const B=h(()=>t.value.length==0),j=h(()=>f.isComponentVisible(i)),O=r=>{if(!r.startsWith("$"))return g=>f.forwardEvent(g,n);if(r.startsWith("$goToPage_")){const g=r.substring(10);return C=>f.setActivePageFromKey(g)}return null},Z=h(()=>{const r={};if(d.value.binding){const v=d.value.binding.eventType,g=`on${v.charAt(0).toUpperCase()}${v.slice(1)}`;r[g]=C=>f.forwardEvent(C,n)}return Object.entries(d.value.handlers??{}).forEach(([v,g])=>{const C=`on${v.charAt(0).toUpperCase()}${v.slice(1)}`;r[C]=O(g)}),r}),ee=h(()=>{var g;const r=(g=f.getComponentDefinition(d.value.type))==null?void 0:g.fields;if(!r)return;const v={};return Object.keys(r).forEach(C=>{r[C].applyStyleVariable&&a.value[C]&&(v[`--${C}`]=a.value[C])}),v}),te=function(){return{class:{component:!0,childless:B.value,selected:x.value},style:{...ee.value,...j.value?{}:{display:"none"}},...b,...Z.value,draggable:e.value}};return()=>{const r=e.value?c():void 0,v=({instanceNumber:k=0,componentFilter:L=()=>!0,positionlessSlot:E=!1})=>B.value?E?void 0:r:m(k,L,E),g={...te()};return D(p,g,{default:v})}}};const Y=w(Ce,[["__scopeId","data-v-5c2885cc"]]),A=l=>(q("data-v-cbbb395f"),l=l(),G(),l),be=A(()=>u("i",{class:"ri-notification-2-line ri-xl"},null,-1)),Ie={class:"counter"},Se=A(()=>u("div",{class:"balloonFlash"},null,-1)),$e={class:"main"},xe=A(()=>u("i",{class:"ri-close-line"},null,-1)),Ee=A(()=>u("i",{class:"ri-error-warning-fill ri-xl"},null,-1)),Te=[Ee],Ve={class:"content"},Ne={class:"title"},Pe={class:"time"},Be={class:"message"},De=J({__name:"RendererNotifications",setup(l){const y=M(I.core),i=N(!1),d=N(null),p=se([]),n=a=>{const{type:t,title:e,message:c,code:o}=a;p.unshift({type:t,title:e,message:c,code:o,timestampReceived:new Date}),p.splice(100),d.value.classList.remove("alert"),d.value.offsetWidth,d.value.classList.add("alert")};ae(()=>{y.addMailSubscription("notification",n)});const s=()=>{p.length!=0&&(i.value=!i.value)},_=()=>{p.splice(0),i.value=!1};return(a,t)=>H(($(),V("div",{class:"RendererNotifications",onClick:s},[u("div",{class:"balloon",ref_key:"balloon",ref:d,title:"Toggle notifications"},[be,u("div",Ie,T(p.length),1)],512),Se,H(u("div",$e,[u("div",{class:"clearContainer"},[u("button",{onClick:_},[xe,ce(" Clear all ")])]),($(!0),V(le,null,re(p,(e,c)=>($(),V("div",{class:"notification",key:c},[u("div",{class:U(["icon",e.type])},Te,2),u("div",Ve,[u("header",null,[u("strong",Ne,T(e.title),1),u("span",Pe,T(e.timestampReceived.toLocaleTimeString()),1)]),u("div",Be,T(e.message),1)])]))),128))],512),[[X,i.value]])],512)),[[X,p.length>0]])}});const Fe=w(De,[["__scopeId","data-v-cbbb395f"]]),Me=l=>(q("data-v-ff754b58"),l=l(),G(),l),ke=Me(()=>u("div",{class:"loadingBar"},null,-1)),Re={class:"rootComponentArea"},we=J({__name:"ComponentRenderer",setup(l){const f=M(I.core),y=Q(f),i=f.getComponents();i.length==0&&console.error("No pages found.");const d=[{componentId:"root",instanceNumber:0}],p=[N(null)],n=N(i[0]),s=h(()=>y.getEvaluatedFields(d)),_=h(()=>({"--accentColor":s.value.accentColor,"--emptinessColor":s.value.emptinessColor,"--containerBackgroundColor":s.value.parentIdBackgroundColor,"--primaryTextColor":s.value.primaryTextColor,"--secondaryTextColor":s.value.secondaryTextColor,"--separatorColor":s.value.separatorColor})),a=h(()=>f.isMessagePending.value);K(()=>s.value.appName,e=>{t(e)},{immediate:!0});function t(e){const c=f.getMode();let o;e&&c=="edit"?o=`${e} | Streamsync Builder`:!e&&c=="edit"?o="Streamsync Builder":e&&c=="run"?o=`${e}`:!e&&c=="run"&&(o="Streamsync App"),document.title=o}return(e,c)=>($(),V("div",{class:U(["ComponentRenderer",{loadingActive:F(a)}]),tabindex:"-1",style:pe(F(_))},[ie(Fe,{class:"notifications"}),ke,u("div",Re,[n.value?($(),de(Y,{key:0,"component-id":n.value.id,"instance-path":d,"instance-data":p},null,8,["component-id"])):z("",!0),ue(e.$slots,"default",{},void 0,!0)])],6))}});const Oe=w(we,[["__scopeId","data-v-ff754b58"]]);export{Oe as default};
