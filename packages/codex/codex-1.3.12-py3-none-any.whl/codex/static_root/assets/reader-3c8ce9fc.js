import{a as b,ba as u,b as f,c as m,o as c,e as p,w as i,k as g,t as k,bb as ee,bc as te,g as s,E as P,B as y,f as C,bd as R,aj as T,D as w,d as v,be as Te,bf as Be,j as n,ay as Re,b9 as oe,bg as Ie,bh as De,bi as $e,bj as ae,r as z,bk as se,F as D,bl as ne,aC as U,b3 as L,bm as xe,bn as Le,aZ as A,aQ as Ve,bo as Ee,M as Oe,J as Ne,K as I,am as W,aS as F,ao as Ae,ap as We,bp as ze,bq as Ue,br as Fe,bs as He,bt as Me,n as H,p as M,bu as O,bv as q,av as N,bw as qe,bx as Ke,by as Ge,bz as je,bA as Ye,bB as Xe,bC as Ze,bD as Je,bE as Qe,bF as et,bG as tt,q as ot,v as at,V as K,b8 as re,C as G,b7 as st,bH as nt,b4 as j,bI as rt}from"./admin-01a715b2.js";import{_ as V,a as ie,b as le,P as it,c as ce}from"./metadata-dialog-d45e09d8.js";const lt={name:"ReaderNavButton",components:{PaginationNavButton:V},props:{value:{type:Number,required:!0},twoPages:{type:Boolean,default:!1}},computed:{...b(u,{storePage:e=>e.page,vertical:e=>{var t;return(t=e.activeSettings)==null?void 0:t.vertical},toRoute(e){return{params:{pk:e.pk,page:this.value}}}}),title(){return"to page "+this.value},disabled(){return this.value===this.storePage||this.twoPages&&!!(this.value%2)&&this.value-1===this.storePage}},methods:{...f(u,["setActivePage"]),onClick(){this.setActivePage(this.value,!0)}}};function ct(e,t,a,d,l,o){const r=V;return e.vertical?(c(),p(r,{key:0,disabled:o.disabled,title:o.title,onClick:o.onClick},{default:i(()=>[g(k(a.value),1)]),_:1},8,["disabled","title","onClick"])):(c(),p(r,{key:1,disabled:o.disabled,title:o.title,to:e.toRoute},{default:i(()=>[g(k(a.value),1)]),_:1},8,["disabled","title","to"]))}const de=m(lt,[["render",ct]]),dt={name:"ReaderBookChangeNavButton",components:{PaginationNavButton:V},props:{direction:{type:String,required:!0}},computed:{...b(u,{toRoute(e){const t=e.routes.books;if(!t)return"";const a=t[this.direction];return a?{params:{...a}}:""}}),title(){return(this.direction==="prev"?"Previous":"Next")+" Book"},icon(){return this.direction==="prev"?ee:te},disabled(){return!this.toRoute}}};function ut(e,t,a,d,l,o){const r=V;return c(),p(r,{icon:"",variant:"plain",disabled:o.disabled,title:o.title,to:e.toRoute},{default:i(()=>[s(P,null,{default:i(()=>[g(k(o.icon),1)]),_:1})]),_:1},8,["disabled","title","to"])}const ue=m(dt,[["render",ut]]),$="prev",x="next",gt={name:"ReaderNavToolbar",components:{PaginationSlider:ie,ReaderNavButton:de,PaginationToolbar:le,ReaderBookChangeNavButton:ue},computed:{...y(u,["activeSettings","activeBook"]),...b(u,{storePage:e=>e.page,key(e){return`${e.pk} - ${this.twoPages}`}}),maxPage(){return this.activeBook?this.activeBook.maxPage:0},twoPages(){return this.activeSettings.twoPages},step(){return this.activeSettings.twoPages?2:1},trackColor(){return this.twoPages&&+this.storePage>=this.maxPage-1?this.$vuetify.theme.current.colors.primary:""},readInReverse(){return this.activeSettings.readInReverse},min(){return this.readInReverse?this.maxPage:0},max(){return this.readInReverse?0:this.maxPage},bookPrev(){return this.readInReverse?"next":"prev"},bookNext(){return this.readInReverse?"prev":"next"}},mounted(){document.addEventListener("keyup",this._keyListener)},beforeUnmount(){document.removeEventListener("keyup",this._keyListener)},methods:{...f(u,["routeToBook","routeToDirection","routeToDirectionOne","routeToPage","setActivePage"]),onSliderUpdate(e){this.activeSettings.vertical?this.setActivePage(e,!0):this.routeToPage(e)},_keyListener(e){switch(e.stopPropagation(),e.key){case" ":!e.shiftKey&&window.innerHeight+window.scrollY+1>=document.body.scrollHeight?this.routeToDirection(x):e.shiftKey&&window.scrollY===0&&this.routeToDirection($);break;case"j":case"ArrowRight":this.routeToDirection(x);break;case"k":case"ArrowLeft":this.routeToDirection($);break;case",":this.routeToDirectionOne($);break;case".":this.routeToDirectionOne(x);break;case"n":this.routeToBook(x);break;case"p":this.routeToBook($);break}}}};function pt(e,t,a,d,l,o){const r=ue,h=de,_=ie,B=le;return o.maxPage?(c(),p(B,{key:0},{default:i(()=>[s(r,{direction:o.bookPrev},null,8,["direction"]),s(h,{value:o.min,"two-pages":o.twoPages},null,8,["value","two-pages"]),(c(),p(_,{key:e.key,"model-value":e.storePage,min:0,max:o.maxPage,step:o.step,"track-color":o.trackColor,reverse:o.readInReverse,"onUpdate:modelValue":t[0]||(t[0]=E=>o.onSliderUpdate(E))},null,8,["model-value","max","step","track-color","reverse"])),s(h,{value:o.max,"two-pages":o.twoPages},null,8,["value","two-pages"]),s(r,{direction:o.bookNext},null,8,["direction"])]),_:1})):C("",!0)}const ge=m(gt,[["render",pt]]),ht={rel:"prefetch",as:"image"},pe=function(e){const t=[];for(const a of e)a&&t.push({...ht,href:a});return{link:t}};const _t={name:"PageChangeLink",props:{direction:{type:String,required:!0}},head(){return pe([this.prefetchSrc1,this.prefetchSrc2])},computed:{...b(u,{params(e){return e.routes[this.computedDirection]},prefetchSrc2(e){const t=e.books.get(this.params.pk);if(!t||!this.getSettings(t).twoPages)return!1;const d={...this.params,page:this.params.page+1};return d.page>t.maxPage?!1:R(d)},directionClass(e){let t=this.direction;return e.activeSettings.vertical&&(t+="Vertical"),t},pageChangeClass(e){let t="pageChange";return t+=e.activeSettings.vertical?"Row":"Column",t}}),computedDirection(){return this.normalizeDirection(this.direction)},prefetchSrc1(){return this.params?R(this.params):!1},route(){return this.params?{params:this.params}:{}},label(){return`${this.computedDirection==="prev"?"Previous":"Next"} Page`}},methods:{...f(u,["getSettings","normalizeDirection"])}};function mt(e,t,a,d,l,o){const r=w("router-link");return c(),p(r,{to:o.route,"aria-label":o.label,class:T({[e.pageChangeClass]:!0,[e.directionClass]:!0}),onClick:t[0]||(t[0]=h=>h.stopImmediatePropagation())},null,8,["to","aria-label","class"])}const he=m(_t,[["render",mt],["__scopeId","data-v-29292846"]]);const kt={name:"LoadingPage",components:{Placeholder:it},props:{twoPages:{type:Boolean,required:!0}}};function vt(e,t,a,d,l,o){const r=w("Placeholder");return c(),v("div",{class:T(["pageLoading",{twoPages:a.twoPages}])},[s(r,{class:"pagePlaceholder"})],2)}const ft=m(kt,[["render",vt],["__scopeId","data-v-13c9bf0b"]]);const Y="unauthorized",bt={name:"ErrorPage",props:{twoPages:{type:Boolean,required:!0},type:{type:String,required:!0}},computed:{text(){return this.type===Y?"Protected page":"Failed to load page"},icon(){return this.type===Y?Te:Be}}},Pt={class:"pageErrorContainer"},wt={class:"pageErrorText"};function St(e,t,a,d,l,o){return c(),v("div",{class:T(["pageError",{twoPages:a.twoPages}])},[n("div",Pt,[n("div",wt,k(o.text),1),s(P,{class:"pageErrorIcon"},{default:i(()=>[g(k(o.icon),1)]),_:1})])],2)}const yt=m(bt,[["render",St],["__scopeId","data-v-3f1e3f4f"]]);const Ct={name:"ImgPage",props:{src:{type:String,required:!0},fitToClass:{type:Object,required:!0}},emits:["load","error"]},Tt=["src"];function Bt(e,t,a,d,l,o){return c(),v("img",Re({class:a.fitToClass,src:a.src},e.$attrs,{onError:t[0]||(t[0]=r=>e.$emit("error")),onLoad:t[1]||(t[1]=r=>e.$emit("load"))}),null,16,Tt)}const X=m(Ct,[["render",Bt],["__scopeId","data-v-5997abff"]]);const Z=oe(Ie(()=>$e(()=>import("./page-pdf-de62e742.js"),["assets/page-pdf-de62e742.js","assets/admin-01a715b2.js","assets/admin-fb40cb89.css","assets/page-pdf-2d7d4f5d.css"]))),Rt=333,It={S:"Screen",W:"Width",H:"Height",O:"Original"},Dt={name:"BookPage",components:{ErrorPage:yt,LoadingPage:ft,PDFPage:Z,ImgPage:X},props:{book:{type:Object,required:!0},page:{type:Number,required:!0}},data(){return{showProgress:!1,loaded:!1,error:!1}},computed:{pageClass(){return this.settings.vertical?"pageVertical":"pageHorizontal"},fitToClass(){let e={};const t=It[this.settings.fitTo];if(t){let a="fitTo";a+=t.charAt(0).toUpperCase()+t.slice(1).toLowerCase(),this.settings.twoPages&&(a+="Two",this.settings.vertical&&(a+="Vertical")),e[a]=!0}return e},src(){const e={pk:this.book.pk,page:this.page};return R(e)},component(){return this.book.fileType==="PDF"?Z:X},settings(){return this.getSettings(this.book)}},mounted(){setTimeout(function(){this.loaded||(this.loading=!0)},Rt)},methods:{...f(u,["getSettings"]),onLoad(){this.showProgress=!1,this.loaded=!0,this.error=!1},onError(){this.error="load",this.showProgress=!1},onUnauthorized(){this.error="unauthorized",this.showProgress=!1}}},$t=["id","data-page"];function xt(e,t,a,d,l,o){const r=w("ErrorPage"),h=w("LoadingPage");return c(),v("div",{id:`page${a.page}`,"data-page":a.page,class:T(o.pageClass)},[l.error?(c(),p(r,{key:0,"two-pages":o.settings.twoPages,type:l.error},null,8,["two-pages","type"])):l.showProgress&&!l.loaded?(c(),p(h,{key:1,"two-pages":o.settings.twoPages},null,8,["two-pages"])):(c(),p(De(o.component),{key:2,src:o.src,"fit-to-class":o.fitToClass,book:a.book,onError:o.onError,onLoad:o.onLoad,onUnauthorized:o.onUnauthorized},null,40,["src","fit-to-class","book","onError","onLoad","onUnauthorized"]))],10,$t)}const _e=m(Dt,[["render",xt],["__scopeId","data-v-f9e0354b"]]);const Lt=48,Vt=48,Et={name:"PagesHorizontalWindow",components:{BookPage:_e,PageChangeLink:he},props:{book:{type:Object,required:!0}},data(){return{activePage:0,pages:[]}},computed:{...y(u,["isOnCoverPage"]),...b(u,{prevBook:e=>{var t;return(t=e.routes.books)==null?void 0:t.prev},nextBook:e=>{var t;return(t=e.routes.books)==null?void 0:t.next},storePage:e=>e.page,storePk:e=>e.pk}),settings(){return this.getSettings(this.book)},twoPages(){return this.settings.twoPages},readInReverse(){return this.settings.readInReverse},secondPage(){return this.settings.twoPages&&!this.isOnCoverPage},windowIndex(){const e=this.activePage-this.pages[0];return Math.min(Math.max(0,e),this.book.maxPage)}},watch:{twoPages(){this.setActivePage(this.storePage,!0)},storePage(e){if(this.book.pk===this.storePk){this.activePage=e;const t=this.pages.at(0),a=this.pages.at(-1);(e<t||e>a)&&this.setPages()}},prevBook(e){this.book.pk===e.pk&&(this.activePage=this.book.maxPage)},nextBook(e){this.book.pk===e.pk&&(this.activePage=0)}},created(){this.book.pk===this.storePk?this.activePage=+this.$route.params.page:this.book.pk===this.prevBook.pk?this.activePage=this.book.maxPage:this.activePage=0,this.setPages()},methods:{...f(u,["getSettings","setBookChangeFlag","setActivePage"]),setPages(){const e=Math.max(this.activePage-Lt,0),t=Math.min(this.activePage+Vt,this.book.maxPage),a=ae.range(e,t+1);this.pages=a}}};function Ot(e,t,a,d,l,o){const r=he,h=w("BookPage");return c(),p(ne,{"show-arrows":"",continuous:"","model-value":o.windowIndex,reverse:o.readInReverse},{prev:i(()=>[s(r,{direction:"prev"})]),next:i(()=>[s(r,{direction:"next"})]),default:i(()=>[(c(!0),v(D,null,z(l.pages,_=>(c(),p(se,{key:`c/${a.book.pk}/${_}`,class:"windowItem",disabled:"",eager:_>=e.storePage-1&&_<=e.storePage+2,"model-value":_,transition:!0},{default:i(()=>[!o.readInReverse||o.secondPage&&_<a.book.maxPage?(c(),p(h,{key:0,book:a.book,page:o.readInReverse?_+1:_},null,8,["book","page"])):C("",!0),o.readInReverse||o.secondPage&&_<a.book.maxPage?(c(),p(h,{key:1,book:a.book,page:o.readInReverse?_:_+1},null,8,["book","page"])):C("",!0)]),_:2},1032,["eager","model-value"]))),128))]),_:1},8,["model-value","reverse"])}const Nt=m(Et,[["render",Ot],["__scopeId","data-v-da9ab604"]]);function me(e,t){const{self:a=!1}=t.modifiers??{},d=t.value,l=typeof d=="object"&&d.options||{passive:!0},o=typeof d=="function"||"handleEvent"in d?d:d.handler,r=a?e:t.arg?document.querySelector(t.arg):window;r&&(r.addEventListener("scroll",o,l),e._onScroll=Object(e._onScroll),e._onScroll[t.instance.$.uid]={handler:o,options:l,target:a?void 0:r})}function ke(e,t){var o;if(!((o=e._onScroll)!=null&&o[t.instance.$.uid]))return;const{handler:a,options:d,target:l=e}=e._onScroll[t.instance.$.uid];l.removeEventListener("scroll",a,d),delete e._onScroll[t.instance.$.uid]}function At(e,t){t.value!==t.oldValue&&(ke(e,t),me(e,t))}const Wt={mounted:me,unmounted:ke,updated:At},zt=12,J=250,Q={threshold:[.75]},Ut={S:Q,H:Q},Ft={name:"PagesVerticalScroller",components:{BookPage:_e},props:{book:{type:Object,required:!0}},data(){return{innerHeight:window.innerHeight,innerWidth:window.innerWidth,intersectorOn:!1,programmaticScroll:!1}},computed:{...b(u,{storePage:e=>e.page}),...U(u,["reactWithScroll"]),settings(){return this.getSettings(this.book)},readInReverse(){return this.settings.readInReverse},items(){var a;const e=((a=this.book)==null?void 0:a.maxPage)+1,t=ae.range(0,e);return this.readInReverse&&t.reverse(),t},visibleItems(){var e;return Math.min(((e=this.book)==null?void 0:e.maxPage)??0,zt)},intersectOptions(){return Ut[this.settings.fitTo]}},watch:{storePage(e){this.reactWithScroll&&this.scrollToPage(e)}},mounted(){window.addEventListener("resize",this.onResize),setTimeout(()=>{this.scrollToPage(this.storePage)},J)},beforeUnmount(){window.removeEventListener("resize",this.onResize)},methods:{...f(u,["setActivePage","setBookChangeFlag","getSettings"]),onIntersect(e,t){if(e&&this.intersectorOn){const d=+t[0].target.dataset.page;this.setActivePage(d,!1)}},onScroll(){if(this.programmaticScroll)return;this.intersectorOn=!0;const e=this.$refs.verticalScroll.$el,t=e.scrollTop;if(this.storePage===0&&t===0)this.setBookChangeFlag("prev");else if(this.storePage===this.book.maxPage){const a=e.scrollTopMax||e.scrollHeight-e.clientTop;window.innerHeight+t+1>=a&&this.setBookChangeFlag("next")}},scrollToPage(e){this.intersectorOn=!1,this.programmaticScroll=!0;const t=this.$refs.verticalScroll;t?t.scrollToIndex(e):console.debug("Can't find vertcalScroll component."),setTimeout(()=>{this.programmaticScroll=!1},J)},onResize(){this.innerHeight=window.innerHeight,this.innerWidth=window.innerWidth}}},Ht=["data-page"];function Mt(e,t,a,d,l,o){const r=w("BookPage");return L((c(),p(Le,{id:"verticalScroll",ref:"verticalScroll",items:o.items,height:l.innerHeight,width:l.innerWidth},{default:i(({item:h})=>[s(r,{book:a.book,page:h},null,8,["book","page"]),L(n("div",{class:"pageTracker","data-page":h},null,8,Ht),[[xe,{handler:o.onIntersect,options:o.intersectOptions},void 0,{quiet:!0}]])]),_:1},8,["items","height","width"])),[[Wt,o.onScroll,"#verticalScroll"]])}const qt=m(Ft,[["render",Mt],["__scopeId","data-v-c5c4cded"]]),Kt={name:"PagesView",components:{PagesHorizontalWindow:Nt,PagesVerticalScroller:qt},props:{book:{type:Object,required:!0}},emits:["click"],computed:{...b(u,{storePk:e=>e.pk}),settings(){return this.getSettings(this.book)},vertical(){return this.settings.vertical}},watch:{$route(e){+e.params.pk===this.book.pk&&this.setActivePage(+e.params.page,!0)}},created(){this.book.pk===this.storePk&&this.setActivePage(+this.$route.params.page,!0)},methods:{...f(u,["getSettings","setActivePage"])}};function Gt(e,t,a,d,l,o){const r=w("PagesVerticalScroller"),h=w("PagesHorizontalWindow");return o.vertical?(c(),p(r,{key:0,book:a.book,onClick:e.$emit.click},null,8,["book","onClick"])):(c(),p(h,{key:1,book:a.book,onClick:e.$emit.click},null,8,["book","onClick"]))}const ve=m(Kt,[["render",Gt]]);const jt={name:"BookChangeActivator",props:{direction:{type:String,required:!0}},computed:{...y(u,["prevBookChangeShow","nextBookChangeShow"]),show(){return this[this.computedDirection+"BookChangeShow"]},computedDirection(){return this.normalizeDirection(this.direction)}},methods:{...f(u,["setBookChangeFlag","normalizeDirection"])}};function Yt(e,t,a,d,l,o){return o.show?(c(),v("div",{key:0,class:T(["bookChangeColumn",{[a.direction]:!0}]),onClick:t[0]||(t[0]=A(r=>e.setBookChangeFlag(a.direction),["stop"]))},null,2)):C("",!0)}const fe=m(jt,[["render",Yt],["__scopeId","data-v-2a8ea6a5"]]);const Xt={name:"BooksWindow",components:{BookChangeActivator:fe,PagesView:ve},emits:["click"],computed:{...b(u,{books:e=>e.books,bookChange:e=>e.bookChange,activeBookPk:e=>e.pk,bookRoutes:e=>e.routes.books})},watch:{$route(e,t){(!t||!t.params||+e.params.pk!=+t.params.pk)&&this.loadBooks(e.params)}},beforeMount(){this.setBookChangeFlag()},created(){this.loadBooks(this.$route.params)},methods:{...f(u,["setBookChangeFlag","loadBooks"]),click(){this.setBookChangeFlag(),this.$emit("click")},eager(e){return this.bookChange&&this.bookRoutes[this.bookChange]&&this.bookRoutes[this.bookChange].pk===e}}};function Zt(e,t,a,d,l,o){const r=fe,h=ve;return c(),p(ne,{id:"booksWindow",direction:"vertical","model-value":e.activeBookPk,"show-arrows":"",onClick:o.click},{prev:i(()=>[s(r,{direction:"prev"})]),next:i(()=>[s(r,{direction:"next"})]),default:i(()=>[(c(!0),v(D,null,z(e.books,([_,B])=>(c(),p(se,{key:`c/${_}`,class:"windowItem",disabled:"",eager:o.eager(_),value:_,transition:!0},{default:i(()=>[s(h,{book:B,onClick:o.click},null,8,["book","onClick"])]),_:2},1032,["eager","value"]))),128))]),_:1},8,["model-value","onClick"])}const be=m(Xt,[["render",Zt],["__scopeId","data-v-ca6f1824"]]);const Jt={name:"ReaderTitleToolbar",components:{MetadataDialog:ce,SettingsDrawerButton:Ve},data(){return{mdiClose:Ee,routeChanged:!1}},head(){return{meta:[{hid:"description",name:"description",content:`reader ${this.activeTitle} page ${this.storePage}`}]}},computed:{...y(u,["activeTitle","activeBook"]),...b(u,{bookChange:e=>e.bookChange,seriesPosition:function(e){return this.activeBook&&e.seriesCount>1?`${this.activeBook.seriesIndex}/${e.seriesCount}`:""},vertical:e=>e.activeSettings.vertical,pk:e=>e.pk||0}),...b(Oe,{lastRoute:e=>e.page.routes.last}),...U(I,["isSettingsDrawerOpen"]),closeBookRoute:function(){const e={name:"browser",params:this.lastRoute};return e.params?e.hash=`#card-${this.pk}`:e.params=window.CODEX.LAST_ROUTE||Ne.browser.route,e}},watch:{$route(e,t){t&&(this.routeChanged=!0)}},mounted(){document.addEventListener("keyup",this._keyListener)},beforeUnmount(){document.removeEventListener("keyup",this._keyListener)},methods:{...f(I,["setTimestamp"]),...f(u,["routeToDirection","routeToDirectionOne","routeToBook","setBookChangeFlag"]),openMetadata(){this.$refs.metadataDialog.dialog=!0},onCloseBook(){this.routeChanged&&this.setTimestamp()},_keyListener(e){switch(e.stopPropagation(),e.key){case"Escape":this.$refs.closeBook.$el.click();break;case"m":this.openMetadata();break}}}},Qt={key:0},eo={key:0,id:"seriesPosition",title:"Series Position"};function to(e,t,a,d,l,o){const r=ce,h=w("SettingsDrawerButton");return c(),p(We,{id:"readerTopToolbar",class:"codexToolbar",density:"compact"},{default:i(()=>[s(F,null,{default:i(()=>[s(W,{id:"closeBook",ref:"closeBook",to:o.closeBookRoute,size:"large",onClick:o.onCloseBook},{default:i(()=>[e.$vuetify.display.smAndDown?(c(),p(P,{key:1,title:"Close Book"},{default:i(()=>[g(k(l.mdiClose),1)]),_:1})):(c(),v("span",Qt,"close book"))]),_:1},8,["to","onClick"])]),_:1}),g(" "+k(e.bookChange)+" ",1),s(Ae,{id:"toolbarTitle",class:"codexToolbarTitle"},{default:i(()=>[g(k(e.activeTitle),1)]),_:1}),e.seriesPosition?(c(),v("span",eo,k(e.seriesPosition),1)):C("",!0),s(F,null,{default:i(()=>[s(W,{id:"tagButton",onClick:A(o.openMetadata,["stop"])},{default:i(()=>[s(r,{ref:"metadataDialog",group:"c",pk:e.pk},null,8,["pk"])]),_:1},8,["onClick"]),s(h,{id:"settingsButton",onClick:t[0]||(t[0]=A(_=>e.isSettingsDrawerOpen=!0,["stop"]))})]),_:1})]),_:1})}const Pe=m(Jt,[["render",to],["__scopeId","data-v-4075b1a2"]]);const oo={name:"BookChangeDrawer",props:{direction:{type:String,required:!0}},head(){return pe([this.prefetchSrc1,this.prefetchSrc2])},computed:{...y(u,["prevBookChangeShow","nextBookChangeShow"]),...b(u,{prefetchSrc2(e){if(!this.params)return!1;const t=e.books.get(this.params.pk),a=this.getSettings(t);if(!this.isDrawerOpen||!this.params||!a.twoPages)return!1;const d={pk:this.params.pk,page:this.params.page+1};return R(d)},isDrawerOpen(e){return e.bookChange===this.computedDirection},params(e){return e.routes.books[this.computedDirection]},icon(){return this.computedDirection==="next"?te:ee}}),show(){return this[this.computedDirection+"BookChangeShow"]},prefetchSrc1(){return!this.isDrawerOpen||!this.params?!1:R(this.params)},route(){return this.params?{params:this.params}:{}},label(){return`${this.computedDirection==="prev"?"Previous":"Next"} Book`},computedDirection(){return this.normalizeDirection(this.direction)}},methods:{...f(u,["getSettings","normalizeDirection"])}};function ao(e,t,a,d,l,o){const r=w("router-link");return o.show?(c(),p(ze,{key:0,class:T({bookChangeDrawer:!0,[a.direction]:!0}),"disable-resize-watcher":"","disable-route-watcher":"",location:o.computedDirection==="prev"?"left":"right","model-value":e.isDrawerOpen,scrim:!1,temporary:"",touchless:""},{default:i(()=>[s(r,{class:"navLink",to:o.route,"aria-label":o.label,title:o.label,onClick:t[0]||(t[0]=h=>h.stopImmediatePropagation())},{default:i(()=>[s(P,{class:"bookChangeIcon"},{default:i(()=>[g(k(e.icon),1)]),_:1})]),_:1},8,["to","aria-label","title"])]),_:1},8,["class","location","model-value"])):C("",!0)}const we=m(oo,[["render",ao],["__scopeId","data-v-33b1e110"]]);const so={name:"DownloadPanel",data(){return{mdiDownload:Ue,mdiFileImage:Fe}},computed:{...y(u,["activeTitle"]),...b(u,{storePage:e=>e.page,pageSrc(e){const t={pk:e.pk,page:e.page};return He(t)},downloadURL(e){return Me(e.pk)}}),...y(u,["activeBook"]),pageName:function(){return`${this.activeTitle} - page ${this.storePage}.jpg`}},methods:{...f(I,["downloadIOSPWAFix"]),downloadPage(){this.downloadIOSPWAFix(this.pageSrc,this.pageName)},downloadBook(){this.downloadIOSPWAFix(this.downloadURL,this.activeBook.filename)}}},no={id:"downloadPanel"};function ro(e,t,a,d,l,o){return c(),v("div",no,[s(M,{onClick:o.downloadPage},{default:i(()=>[s(H,null,{default:i(()=>[s(P,null,{default:i(()=>[g(k(l.mdiFileImage),1)]),_:1}),g("Download Page "+k(e.storePage),1)]),_:1})]),_:1},8,["onClick"]),s(M,{onClick:o.downloadBook},{default:i(()=>[s(H,null,{default:i(()=>[s(P,null,{default:i(()=>[g(k(l.mdiDownload),1)]),_:1}),g("Download Book ")]),_:1})]),_:1},8,["onClick"])])}const Se=m(so,[["render",ro],["__scopeId","data-v-c3777662"]]);const io=["fitTo","twoPages","vertical","readInReverse"],lo={name:"ReaderSettingsPanel",data(){return{isGlobalScope:!1}},computed:{...b(u,{fitToChoices(e){const t=[];for(const a of e.choices.fitTo)a.value&&t.push(a);return t},selectedSettings:function(e){return this.isGlobalScope||!e.activeBook?e.readerSettings:e.activeBook.settings},isClearSettingsButtonDisabled:function(e){if(this.isGlobalScope||!e.activeBook)return!0;for(const t of io){const a=e.activeBook.settings[t];if(!e.choices.nullValues.has(a))return!1}return!0},verticalLabel(e){const t=e.activeBook&&e.activeBook.settings?e.activeBook.settings.vertical:void 0;return t==null?"Horizontal or Vertical":t?"Scroll Pages Vertically":"Turn Pages Horizontally"},params(e){return{pk:e.pk,page:e.page}}}),...U(u,["readRTLInReverse"])},mounted(){document.addEventListener("keyup",this._keyListener)},beforeUnmount(){document.removeEventListener("keyup",this._keyListener)},methods:{...f(u,["clearSettingsLocal","setSettingsGlobal","setSettingsLocal"]),settingsDialogChanged:function(e){this.isGlobalScope?this.setSettingsGlobal(this.params,e):this.setSettingsLocal(this.params,e)},_keyListener:function(e){e.stopPropagation();let t;switch(e.key){case"w":t={fitTo:"W"};break;case"h":t={fitTo:"H"};break;case"s":t={fitTo:"S"};break;case"o":t={fitTo:"O"};break;case"2":t={twoPages:!this.selectedSettings.twoPages};break;case"r":t={readInReverse:!this.selectedSettings.readInReverse};break;case"v":t={vertical:!this.selectedSettings.vertical}}t&&this.setSettingsLocal(this.params,t)}}},co={id:"readerSettings"};function uo(e,t,a,d,l,o){return c(),v("div",co,[s(q,{modelValue:l.isGlobalScope,"onUpdate:modelValue":t[0]||(t[0]=r=>l.isGlobalScope=r),density:"compact",label:"Scope","hide-details":"auto"},{default:i(()=>[s(O,{label:"Only this comic",value:!1}),s(O,{label:"Default for all comics",value:!0})]),_:1},8,["modelValue"]),s(q,{class:"displayRadioGroup",density:"compact",label:"Display","hide-details":"auto","model-value":e.selectedSettings.fitTo,"onUpdate:modelValue":t[1]||(t[1]=r=>o.settingsDialogChanged({fitTo:r}))},{default:i(()=>[(c(!0),v(D,null,z(e.fitToChoices,r=>(c(),p(O,{key:r.value,label:r.title,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["model-value"]),s(N,{disabled:e.selectedSettings.vertical,class:"displayTwoPages",density:"compact",label:"Two pages","hide-details":"auto","model-value":e.selectedSettings.twoPages,"true-value":!0,indeterminate:e.selectedSettings.twoPages===null||e.selectedSettings.twoPages===void 0,"onUpdate:modelValue":t[2]||(t[2]=r=>o.settingsDialogChanged({twoPages:r}))},null,8,["disabled","model-value","indeterminate"]),s(qe,null,{default:i(()=>[g("Reading Direction")]),_:1}),s(Ke,{class:"vertical",density:"compact",label:e.verticalLabel,"hide-details":"auto","model-value":e.selectedSettings.vertical,"true-value":!0,indeterminate:e.selectedSettings.vertical===null||e.selectedSettings.vertical===void 0,"onUpdate:modelValue":t[3]||(t[3]=r=>o.settingsDialogChanged({vertical:r}))},null,8,["label","model-value","indeterminate"]),s(N,{class:"readInReverse",density:"compact",label:"Read in Reverse","hide-details":"auto","model-value":e.selectedSettings.readInReverse,"true-value":!0,indeterminate:e.selectedSettings.readInReverse===null||e.selectedSettings.readInReverse===void 0,"onUpdate:modelValue":t[4]||(t[4]=r=>o.settingsDialogChanged({readInReverse:r}))},null,8,["model-value","indeterminate"]),l.isGlobalScope?(c(),p(N,{key:0,"model-value":e.selectedSettings.readRtlInReverse,class:"readRtlInReverse",density:"compact",label:"Read RTL comics in Reverse","hide-details":"auto","true-value":!0,"onUpdate:modelValue":t[5]||(t[5]=r=>o.settingsDialogChanged({readRtlInReverse:r}))},null,8,["model-value"])):C("",!0),l.isGlobalScope?C("",!0):(c(),p(W,{key:1,id:"clearSettingsButton",disabled:e.isClearSettingsButtonDisabled,title:"Use the default settings for all comics for this comic",onClick:t[6]||(t[6]=r=>e.clearSettingsLocal(e.params))},{default:i(()=>[g(" Clear Comic Settings ")]),_:1},8,["disabled"]))])}const ye=m(lo,[["render",uo],["__scopeId","data-v-72cc1f00"]]);const go={name:"KeyboardShortcutsPanel",data(){return{mdiMenuLeft:Ge,mdiMenuRight:je,mdiKeyboardOutline:Ye,mdiKeyboardSpace:Xe,mdiAppleKeyboardShift:Ze}},computed:{...y(I,["isMobile"])}},S=e=>(ot("data-v-41483eb9"),e=e(),at(),e),po=S(()=>n("h4",null,"Navigation",-1)),ho={class:"highlight-table"},_o=S(()=>n("td",null,"Previous page",-1)),mo=S(()=>n("td",null,"Next page",-1)),ko=S(()=>n("tr",null,[n("td",null,","),n("td",null,[g("Next "),n("em",null,"only"),g(" one page in two page mode.")])],-1)),vo=S(()=>n("tr",null,[n("td",null,"."),n("td",null,[g("Previous "),n("em",null,"only"),g(" one page in two page mode.")])],-1)),fo=S(()=>n("tr",null,[n("td",null,"p"),n("td",null,"Previous Book")],-1)),bo=S(()=>n("tr",null,[n("td",null,"n"),n("td",null,"Next Book")],-1)),Po=S(()=>n("h4",null,"Fit Page To",-1)),wo=S(()=>n("table",{class:"highlight-table"},[n("tbody",null,[n("tr",null,[n("td",null,"s"),n("td",null,"screen")]),n("tr",null,[n("td",null,"h"),n("td",null,"screen height")]),n("tr",null,[n("td",null,"w"),n("td",null,"screen width")]),n("tr",null,[n("td",null,"o"),n("td",null,"Show page at original size")]),n("tr",null,[n("td",null,"2"),n("td",null,"Toggle two page view")]),n("tr",null,[n("td",null,"r"),n("td",null,"Toggle Read in Reverse")])])],-1)),So=S(()=>n("h4",null,"Other",-1)),yo=S(()=>n("table",{class:"highlight-table"},[n("tbody",null,[n("tr",null,[n("td",null,"m"),n("td",null,"Show comic's metadata")]),n("tr",null,[n("td",null,"esc"),n("td",null,"Close book")])])],-1));function Co(e,t,a,d,l,o){return e.isMobile?C("",!0):(c(),p(tt,{key:0},{default:i(()=>[s(Je,{id:"readerKeyboardShortcuts"},{default:i(()=>[s(Qe,{id:"shortcutsTitle"},{default:i(()=>[s(P,{id:"keyboardIcon"},{default:i(()=>[g(k(l.mdiKeyboardOutline),1)]),_:1}),g("Keyboard Shortcuts ")]),_:1}),s(et,null,{default:i(()=>[po,n("table",ho,[n("tbody",null,[n("tr",null,[n("td",null,[s(P,{class:"keyIcon",density:"compact"},{default:i(()=>[g(k(l.mdiMenuLeft),1)]),_:1}),g(", j, "),n("div",null,[s(P,{class:"keyIcon",density:"compact"},{default:i(()=>[g(k(l.mdiAppleKeyboardShift),1)]),_:1}),s(P,{class:"keyIcon",density:"compact"},{default:i(()=>[g(k(l.mdiKeyboardSpace),1)]),_:1})])]),_o]),n("tr",null,[n("td",null,[s(P,{class:"keyIcon",density:"compact"},{default:i(()=>[g(k(l.mdiMenuRight),1)]),_:1}),g(", k, "),s(P,{class:"keyIcon",density:"compact"},{default:i(()=>[g(k(l.mdiKeyboardSpace),1)]),_:1})]),mo]),ko,vo,fo,bo])]),Po,wo,So,yo]),_:1})]),_:1})]),_:1}))}const To=m(go,[["render",Co],["__scopeId","data-v-41483eb9"]]),Bo={name:"ReaderSettingsSuperPanel",components:{DownloadPanel:Se,ReaderKeyboardShortcutsPanel:To,ReaderSettingsPanel:ye}};function Ro(e,t,a,d,l,o){const r=ye,h=w("ReaderKeyboardShortcutsPanel"),_=Se;return c(),v(D,null,[s(r),s(K),s(h),s(K),s(_)],64)}const Io=m(Bo,[["render",Ro]]);const Do={name:"MainReader",components:{BookChangeDrawer:we,BooksWindow:be,ReaderNavToolbar:ge,ReaderTitleToolbar:Pe,SettingsDrawer:re},data(){return{showToolbars:!1,ReaderSettingsSuperPanel:oe(Io)}},computed:{...y(G,["isCodexViewable"]),...b(G,{user:e=>e.user})},watch:{user(){this.loadReaderSettings()},isCodexViewable(){this.loadReaderSettings()}},created(){I().isSettingsDrawerOpen=!1,this.loadReaderSettings()},methods:{...f(u,["loadReaderSettings"]),toggleToolbars(){this.showToolbars=!this.showToolbars}}},$o={key:0,id:"readerContainer"},xo={key:1,id:"announcement"};function Lo(e,t,a,d,l,o){const r=we,h=Pe,_=be,B=ge,E=w("router-link"),Ce=re;return c(),v(D,null,[s(st,{id:"readerWrapper"},{default:i(()=>[s(r,{direction:"prev"}),e.isCodexViewable?(c(),v("div",$o,[s(nt,null,{default:i(()=>[L(s(h,null,null,512),[[j,l.showToolbars]])]),_:1}),s(_,{onClick:o.toggleToolbars},null,8,["onClick"]),s(rt,null,{default:i(()=>[L(s(B,null,null,512),[[j,l.showToolbars]])]),_:1})])):(c(),v("div",xo,[n("h1",null,[s(E,{to:{name:"home"}},{default:i(()=>[g(" Log in ")]),_:1}),g(" to read comics ")])]))]),_:1}),s(r,{direction:"next"}),s(Ce,{title:"Reader Settings",panel:l.ReaderSettingsSuperPanel,temporary:""},null,8,["panel"])],64)}const Oo=m(Do,[["render",Lo],["__scopeId","data-v-dff2aac6"]]);export{Oo as default};
