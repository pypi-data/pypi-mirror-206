"use strict";(self.webpackChunkroboweb_extension=self.webpackChunkroboweb_extension||[]).push([[568],{568:(e,t,o)=>{o.r(t),o.d(t,{default:()=>g});var n=o(33),l=(o(169),o(123)),s=o(832);o(820),o(687);const{Terminal:c}=o(186);class r extends s.Widget{constructor(){super(),this.id="assistant-panel",this.addClass("assistant-panel"),this.title.caption="Assistant",this.title.iconClass="fa fa-robot"}}class i{constructor(e,t){this.manager=e,this.notebook=t,this.enableThemeSync=!0}isJupyter(){return console.log("isJupyter"),!0}currentWindowType(){return console.log("currentWindowType"),"notebook"}getCurrentJupyterTheme(){return console.log("getCurrentJupyterTheme"),this.manager.theme}changeThemeJupyter(e){console.log("changeThemeJupyter"),manager.setTheme(e),this.enableThemeSync=!1}run(e){console.log("run");const t=this.notebook;t?(t.title.label,t.content.activeCellIndex=e,l.NotebookActions.runAllBelow(t.content,t.sessionContext)):console.log("No notebook is active")}runAll(){console.log("runAll");const e=this.notebook;e?(e.title.label,l.NotebookActions.runAll(e.content,e.sessionContext)):console.log("No notebook is active")}insertCellAt(e,t,o){if(console.log("insertCellAt"),e=e.trim(),t>=this.notebook.content.model.cells.length){const t=this.notebook.content.model.contentFactory.createCodeCell({});t.value.text=e,this.notebook.content.model.cells.push(t)}else if(o)this.notebook.content.model.cells.get(t).value.text=e;else{const o=this.notebook.content.model.contentFactory.createCodeCell({});o.value.text=e,this.notebook.content.model.cells.insert(t,o)}}getNotebookContext(){const e=this.notebook;if(!e)return;const t=[];for(var o=0;o<e.model.cells.length;o++){const s=e.model.cells.get(o).toJSON();var n="";if(s.outputs.length>0){const e=s.outputs[0].traceback;if(null!=e)for(var l=0;l<e.length;l++)n+=d(e[l])+"\n";else n=d(s.outputs[0].text)}t.push({input:s.source,output:n})}return{cells:t,insertCellIndex:e.content.activeCellIndex}}}function a(e,t){var o=e();null!==o?t(o):setTimeout((function(){a(e,t)}),100)}function u(){var e=function(e){if(e.startsWith("/user/")){const t=e.split("/")[2];if(null!=t)return`/user/${t}/roboweb-server-extension`}const t=e.split("/"),o=t.indexOf("lab");console.log("labIndex: "+o+"\n");const n=t.slice(0,o);return-1==o?"/roboweb-server-extension":(n.push("roboweb-server-extension"),n.join("/"))}(window.location.pathname);window.isJupyter=!0,window.serviceWorkerVersion="124778936";const t=document.createElement("script"),o=`${e}/flutter.js`;t.src=o,document.head.appendChild(t),t.onload=function(){_flutter.loader.loadEntrypoint({serviceWorker:{serviceWorkerVersion}}).then((function(e){a((function(){return document.getElementById("assistant-panel")}),(function(t){e.initializeEngine({hostElement:t}).then((function(e){return e.runApp()}))}))}))}}function d(e){return e.replace(/\x1B(?:[@-Z\\-_]|\[[0-?]*[ -/]*[@-~])/g,"")}const g={id:"roboweb-extension",requires:[l.INotebookTracker,n.ICommandPalette,n.IThemeManager],activate:(e,t,o,n)=>{console.log("Roboweb extension activated v0.1"),window.notebookAPI=new i(n,null),l.NotebookActions.executed.connect((async(e,t)=>{const{cell:o,notebook:n,success:l,error:s}=t,{input:c,output:r}=function(e){var t="",o=e.model.toJSON();return o.outputs.length>0&&(t=d(o.outputs[0].text)),{input:e.model.value.text,output:t}}(o),i=n.widgets.indexOf(o);if(!l&&null!=s.errorName&&null!=s.errorValue){const{context:e,type:t}=window.lastContext,o=s.errorName+": "+s.errorValue;console.log("Error: "+o),console.log("Context: "+e),console.log("Input: "+c),console.log("Output: "+r),null==c||null==r||null==e?console.log("Null value detected"):window.autoPrompt(o,t,e,c,r.length<2e3?r:o,i)}})),n.themeChanged.connect(((e,t)=>{window.enableThemeSync?null!=window.changeThemeFlutter&&window.changeThemeFlutter(t.newValue):window.enableThemeSync=!0})),t.widgetAdded.connect(((e,t)=>{console.log("A new notebook has been created:",t),null!=window.newChat&&window.newChat()})),e.shell.currentChanged.connect((function(e,t){t.oldValue;const o=t.newValue;if(null!=o&&(window.newWidget=o,"fe"==o.constructor.name)){const e=o;window.notebookAPI=new i(n,e),window.notebook=e;const t=e.sessionContext;t&&t.kernelChanged.connect((e=>{const o=t.session?.kernel;o&&(console.log("starting debugger"),async function(e){const t=new URL(window.location.href).origin+"/roboweb-server-extension/debugger.py",o=await fetch(t),n=await o.text(),l=await async function(e,t){return new Promise((async(o,n)=>{try{console.log("Executing code silently:"+t);const n=e.requestExecute({code:t,silent:!1});let l="";n.onIOPub=e=>{if("execute_result"===e.header.msg_type&&e.content.data["text/plain"],"stream"===e.header.msg_type){const t=e.content.text;l+=t}},await n.done,o(l)}catch(e){n(e)}}))}(e,n);console.log(l)}(o),function(e){e.registerCommTarget("debugger_comm_target",((e,t)=>{console.log("Registered debugger_comm_target"),e.onMsg=e=>{console.log("Message received from Python:",e),function(e){console.log("Executing JavaScript function with message:",e),window.lastMSG=e,window.lastContext=e.content.data}(e)}}))}(o))})),e.content.activeCellChanged.connect((async(t,o)=>{null!=o&&(e.content.widgets.indexOf(o),null!=window.reloadNotebookContext&&window.reloadNotebookContext())}))}}));const s=new r;s.node.style.minWidth="450px",e.shell.add(s,"right",{rank:0}),window.addEventListener("click",(function(e){document.querySelector("#assistant-panel").contains(e.target)||null!=window.removeFocus&&window.removeFocus()}),{passive:!0}),u()},autoStart:!0}}}]);