import{c as g,o as n,e as m,aw as N,r as P,w as c,ax as M,ay as S,ap as K,bJ as Q,am as w,J,G as Y,bK as X,a as C,M as k,d as h,g as s,bL as Z,aj as B,f,t as p,bM as x,j as r,F as $,bN as ee,bO as te,y as ae,k as v,E as T,D as L,at as se,q as A,v as F,I as le,bP as oe,_ as j,bq as re,bQ as ne,B as ue,C as ie,b1 as de,bt as ce,a$ as me,b0 as pe,bR as he,aW as I,b as R,K as fe,aV as _e,aZ as ve,l as ge,aO as be,au as ye}from"./admin-186b2dfa.js";const ke={name:"PaginationToolbar"};function Ce(e,t,a,d,u,l){return n(),m(K,{class:"paginationToolbar codexToolbar",density:"compact",transform:"center bottom"},N({_:2},[P(e.$slots,(i,o)=>({name:o,fn:c(b=>[M(e.$slots,o,S({props:i},b),void 0,!0)])}))]),1024)}const Mt=g(ke,[["render",Ce],["__scopeId","data-v-cfa8cce0"]]);const Se={name:"PaginationSlider"};function we(e,t,a,d,u,l){return n(),m(Q,S({"thumb-size":"36",class:"paginationSlider",density:"compact","hide-details":"auto",rounded:!0,"show-ticks":"always",step:1,"thumb-label":"always"},e.$attrs),null,16)}const $t=g(Se,[["render",we],["__scopeId","data-v-825b160e"]]);const Te={name:"PaginationNavButton"};function Pe(e,t,a,d,u,l){return n(),m(w,S({class:"paginationNavButton",height:"100%"},e.$attrs),N({_:2},[P(e.$slots,(i,o)=>({name:o,fn:c(b=>[M(e.$slots,o,S({props:i},b),void 0,!0)])}))]),1040)}const Lt=g(Te,[["render",Pe],["__scopeId","data-v-852fad11"]]),D=J.browser.vuetifyNullCode,O="None",Ie={value:D,title:O},Be=function(e,t){let a;return e===void 0?a=e:e instanceof Object?(a={value:e.pk,title:e.name},e.pk===null||e.name===void 0?a.value=D:t||(a.value=+e.pk),(a.title===null||a.value===void 0)&&(a.title=O)):e===null?a=Ie:a={value:e,title:e.toString()},a},Re=function(e,t){return e.title<t.title?-1:e.title>t.title?1:0},Ve=function(e,t){return Number.parseFloat(e.title)-Number.parseFloat(t.title)},Ne=function(e,t,a=!1,d=!1){const u=e||[],l=t&&t.toLowerCase();let i=[];for(const b of u){const _=Be(b,d);_&&(!l||_.title&&_.title.toLowerCase().includes(l))&&i.push(_)}const o=a?Ve:Re;return i.sort(o)};const Me={name:"PlaceholderLoading",props:{indeterminate:{type:Boolean,default:!0}}};function $e(e,t,a,d,u,l){return n(),m(Y,S({"aria-label":"loading",class:"codexProgressCircular",indeterminate:a.indeterminate},e.$attrs),null,16,["indeterminate"])}const E=g(Me,[["render",$e],["__scopeId","data-v-7bb4cf22"]]),Le=(e,t)=>e?`${X(e)}/cover.webp?${t}`:window.CODEX.MISSING_COVER;const Ae={name:"BookCover",props:{group:{type:String,required:!0},childCount:{type:Number,default:1},finished:{type:Boolean},coverPk:{type:Number,required:!0}},data(){return{showPlaceholder:!1}},computed:{...C(k,{coverSrc:function(e){return Le(this.coverPk,e.page.coversTimestamp)}})},mounted:function(){this.delayPlaceholder()},methods:{delayPlaceholder:function(){setTimeout(()=>{this.showPlaceholder=!0},2e3)}}},Fe={class:"bookCover"},je={key:1,class:"childCount"};function De(e,t,a,d,u,l){return n(),h("div",Fe,[s(Z,{src:e.coverSrc,class:"coverImg"},null,8,["src"]),a.finished!==!0?(n(),h("div",{key:0,class:B({unreadFlag:!0,mixedreadFlag:a.finished===null})},null,2)):f("",!0),a.group!=="c"?(n(),h("span",je,p(a.childCount),1)):f("",!0)])}const q=g(Ae,[["render",De],["__scopeId","data-v-9acb5f6a"]]);const Oe={name:"MetadataTags",props:{label:{type:String,required:!0},items:{type:Array,default(){return[]}},values:{type:Array,default(){return[]}}},data(){return{mdiFilter:x}},computed:{...C(k,{filterValues:function(e){return e.settings.filters[this.label.toLowerCase()]}}),model(){return Ne(this.values)}},methods:{chipColor:function(e){return this.filterValues&&this.filterValues.includes(e)?this.$vuetify.theme.current.colors["primary-darken-1"]:""}}},Ee={key:0,class:"tags"},qe={class:"label"};function Ue(e,t,a,d,u,l){return l.model&&l.model.length>0?(n(),h("div",Ee,[s(te,{value:l.model,multiple:"",class:"chipGroup"},{default:c(()=>[r("div",qe,p(a.label),1),(n(!0),h($,null,P(l.model,i=>(n(),m(ee,{key:`${a.label}/${i.value}`,color:l.chipColor(i.value),value:i.value,text:i.title},null,8,["color","value","text"]))),128))]),_:1},8,["value"])])):f("",!0)}const U=g(Oe,[["render",Ue],["__scopeId","data-v-80903885"]]);const ze={name:"MetadataTextBox",props:{label:{type:String,required:!0},value:{type:[Object,String,Number,Boolean],default:void 0},link:{type:Boolean,default:!1},group:{type:String,default:""},obj:{type:Object,default:void 0}},data(){return{mdiOpenInNew:ae}},computed:{computedValue(){return this.value!=null&&this.value instanceof Object?this.value.name:this.value},highlight(){var e;return((e=this.obj)==null?void 0:e.group)===this.group},pathArray(){if(this.computedValue)return this.computedValue.split("/")},folderPath(){if(this.pathArray)return this.pathArray.slice(0,-1).join("/")},basePath(){if(this.pathArray)return this.pathArray.at(-1)},groupTo(){const e=k();if(this.group!=="f"&&!e.settings.show[this.group]||this.group==="f"&&!e.page.adminFlags.folderView)return;let t;if(t=this.obj&&this.obj.group==this.group?this.obj.pk:this.value.pk,!t)return;const a=this.$router.currentRoute.value.params;if(!(a.group===this.group&&+a.pk===t))return{name:"browser",params:{group:this.group,pk:t}}}}},Ge={class:"textLabel"},He={class:"textValue"},We=["href"],Ke={key:3,class:"textContent"},Qe={key:4,id:"basePath"};function Je(e,t,a,d,u,l){const i=L("router-link");return l.computedValue?(n(),h("div",{key:0,class:B(["text",{highlight:l.highlight}])},[r("div",Ge,p(a.label),1),r("div",He,[l.groupTo&&a.group==="f"?(n(),m(i,{key:0,id:"folderPath",to:l.groupTo,title:"Browse Folder"},{default:c(()=>[v(p(l.folderPath)+"/",1)]),_:1},8,["to"])):l.groupTo?(n(),m(i,{key:1,class:"textContent",to:l.groupTo,title:`Browse ${a.label}`},{default:c(()=>[v(p(l.computedValue),1)]),_:1},8,["to","title"])):a.link?(n(),h("a",{key:2,href:l.computedValue,target:"_blank"},[v(p(l.computedValue)+" ",1),s(T,{size:"small"},{default:c(()=>[v(p(u.mdiOpenInNew),1)]),_:1})],8,We)):(n(),h("div",Ke,p(l.computedValue),1)),l.groupTo&&a.group==="f"?(n(),h("span",Qe,p(l.basePath),1)):f("",!0)])],2)):f("",!0)}const z=g(ze,[["render",Je],["__scopeId","data-v-7a19eb52"]]);const Ye={name:"MetadatacreatorsTable",props:{value:{type:Array,default:void 0}},data(){return{}},computed:{sortedcreators:function(){return this.value?[...this.value].sort(this.creatorsCompare):[]},...C(k,{filteredCreators(e){return e.settings.filters.creators}})},methods:{roleName:function(e){return e==="CoverArtist"?"Cover Artist":e},creatorSortable:function(e){const t=e.person.name.split(" ");let a=[];return t&&(a.push(t.slice(-1)),t.length>1&&a.push(t.slice(0,-1))),a.push(e.role.name),a.join(" ")},creatorsCompare:function(e,t){const a=this.creatorSortable(e),d=this.creatorSortable(t);return a<d?-1:a>d?1:0},isFilteredCreator(e){return this.filteredCreators&&this.filteredCreators.includes(e)}}},G=e=>(A("data-v-f650684d"),e=e(),F(),e),Xe=G(()=>r("h2",null,"Credits",-1)),Ze={class:"highlight-table"},xe=G(()=>r("thead",null,[r("tr",null,[r("th",{class:"text-left"},"Role"),r("th",{class:"text-left"},"Person")])],-1)),et={class:"highlight"};function tt(e,t,a,d,u,l){return l.sortedcreators&&l.sortedcreators.length>0?(n(),m(se,{key:0,id:"creatorsTable"},{default:c(()=>[Xe,r("table",Ze,[xe,r("tbody",null,[(n(!0),h($,null,P(l.sortedcreators,i=>(n(),h("tr",{key:i.pk},[r("td",null,p(l.roleName(i.role.name)),1),r("td",{class:B({filteredOn:l.isFilteredCreator(i.person.pk)})},[r("span",et,p(i.person.name),1)],2)]))),128))])])]),_:1})):f("",!0)}const at=g(Ye,[["render",tt],["__scopeId","data-v-f650684d"]]),st=({pk:e,page:t,readLtr:a,pageCount:d})=>{if(d){if(t)t=Number(t);else if(a)t=0;else{const u=Number(d)-1;t=Math.max(u,0)}return{name:"reader",params:{pk:e,page:t}}}},V=le("metadata",{state:()=>({md:void 0}),actions:{async loadMetadata({group:e,pk:t}){const a=k();await oe.getMetadata({group:e,pk:t},a.settings).then(d=>(this.md=d.data,!0)).catch(d=>{console.error(d),this.clearMetadata()})},clearMetadata(){this.md=void 0}}});const lt=1160,ot=.05,rt=250,nt={name:"MetadataButton",components:{BookCover:q,CloseButton:j,MetadatacreatorsTable:at,MetadataTags:U,MetadataText:z,PlaceholderLoading:E},props:{group:{type:String,required:!0},pk:{type:Number,required:!0},children:{type:Number,default:1}},data(){return{mdiDownload:re,mdiTagOutline:ne,dialog:!1,progress:0}},computed:{...ue(ie,["isUserAdmin"]),...C(k,{twentyFourHourTime:e=>e.settings.twentyFourHourTime}),...C(V,{md:e=>e.md,downloadFileName:e=>{const t=e.md;return e.md.path?t.path.split("/").at(-1):de({seriesName:t.series.name,volumeName:t.volume.name,issue:t.issue,issueSuffix:t.issueSuffix})+"."+globalThis.fileType.toLowerCase()}}),...C(k,{q:e=>e.settings.q}),downloadURL:function(){return ce(this.pk)},isReadButtonShown:function(){return this.group==="c"&&this.$route.name!="reader"},isReadButtonEnabled:function(){return this.$route.name==="browser"&&!!this.readerRoute},readButtonIcon:function(){return this.isReadButtonEnabled?me:pe},readerRoute:function(){return st(this.md)},formattedIssue:function(){if(!((this.md.issue===null||this.md.issue===void 0)&&!this.md.issueSuffix))return he({issue:this.md.issue,issueSuffix:this.md.issueSuffix})},ltrText:function(){return this.md.readLtr?"Left to Right":"Right to Left"},pages:function(){let e="";if(this.md.page){const a=I.numberFormat(this.md.page,0);e+=`Read ${a} of `}const t=I.numberFormat(this.md.pageCount,0);return e+=`${t} pages`,this.md.progress>0&&(e+=` (${Math.round(this.md.progress)}%)`),e},size:function(){return I.filesize(this.md.size)},fileType:function(){return this.md.fileType||"Unknown"}},watch:{dialog:function(e){e?this.dialogOpened():this.clearMetadata()}},methods:{...R(V,["clearMetadata","loadMetadata"]),...R(fe,["downloadIOSPWAFix"]),dialogOpened:function(){this.loadMetadata({group:this.group,pk:this.pk}),this.startProgress()},startProgress:function(){this.startTime=Date.now(),this.estimatedMS=Math.max(ot,this.children/lt)*1e3,this.updateProgress()},updateProgress:function(){const e=Date.now()-this.startTime;this.progress=e/this.estimatedMS*100,!(this.progress>=100||this.md)&&setTimeout(()=>{this.updateProgress()},rt)},formatDateTime:function(e){return _e(e,this.twentyFourHourTime)},download(){this.downloadIOSPWAFix(this.downloadURL,this.md.filename)}}},ut=e=>(A("data-v-f9d6e29f"),e=e(),F(),e),it={id:"metadataHeader"},dt={id:"metadataBookCoverWrapper"},ct={class:"headerHalfRow"},mt={class:"headerQuarterRow"},pt={class:"mdSection"},ht={key:0,class:"inlineRow"},ft={id:"metadataBody"},_t={class:"mdSection"},vt={class:"thirdRow"},gt={class:"mdSection"},bt={class:"quarterRow"},yt={class:"lastSmallRow"},kt={class:"halfRow mdSection"},Ct={class:"mdSection"},St={class:"mdSection"},wt={class:"mdSection"},Tt={class:"mdSection"},Pt={id:"footerLinks"},It={id:"bottomRightButtons"},Bt={key:1,id:"placeholderContainer"},Rt=ut(()=>r("div",{id:"placeholderTitle"},"Tags Loading",-1));function Vt(e,t,a,d,u,l){const i=j,o=z,b=q,_=U,H=L("MetadatacreatorsTable"),W=E;return n(),m(ye,{modelValue:u.dialog,"onUpdate:modelValue":t[5]||(t[5]=y=>u.dialog=y),fullscreen:"",transition:"dialog-bottom-transition"},{activator:c(({props:y})=>[s(w,S({"aria-label":"tags",class:"tagButton cardControlButton",icon:"",title:"Tags",variant:"text"},y,{onClick:t[0]||(t[0]=ve(()=>{},["prevent"]))}),{default:c(()=>[s(T,null,{default:c(()=>[v(p(u.mdiTagOutline),1)]),_:1})]),_:2},1040)]),default:c(()=>[e.md?(n(),h("div",{key:0,id:"metadataContainer",onKeyup:t[3]||(t[3]=be(y=>u.dialog=!1,["esc"]))},[r("header",it,[s(i,{class:"closeButton",title:"Close Metadata (esc)",size:"x-large",onClick:t[1]||(t[1]=y=>u.dialog=!1)}),e.q?(n(),m(o,{key:0,id:"search",value:e.q,label:"Search Query",highlight:!0},null,8,["value"])):f("",!0),r("div",dt,[s(b,{id:"bookCover","cover-pk":e.md.coverPk,group:a.group,"child-count":e.md.childCount,finished:e.md.finished},null,8,["cover-pk","group","child-count","finished"]),s(ge,{class:"bookCoverProgress","model-value":e.md.progress,rounded:"","background-color":"inherit",height:"2","aria-label":"% read"},null,8,["model-value"])]),r("div",ct,[s(o,{id:"publisher",value:e.md.publisher,group:"p",label:"Publisher",obj:{pk:e.md.id,group:e.md.group}},null,8,["value","obj"]),s(o,{id:"imprint",value:e.md.imprint,group:"i",label:"Imprint",obj:{pk:e.md.id,group:e.md.group}},null,8,["value","obj"])]),s(o,{id:"series",value:e.md.series,label:"Series",group:"s",obj:{pk:e.md.id,group:e.md.group}},null,8,["value","obj"]),r("div",mt,[s(o,{id:"volume",value:e.md.volume,label:"Volume",group:"v",obj:{pk:e.md.id,group:e.md.group}},null,8,["value","obj"]),s(o,{value:e.md.seriesVolumeCount,label:"Volume Count"},null,8,["value"]),s(o,{id:"issue",value:l.formattedIssue,label:"Issue",group:"c",obj:{pk:e.md.id,group:e.md.group}},null,8,["value","obj"]),s(o,{value:e.md.volumeIssueCount,label:"Issue Count"},null,8,["value"])]),r("section",pt,[s(o,{value:e.md.name,label:"Title"},null,8,["value"]),e.md.year||e.md.month||e.md.day?(n(),h("div",ht,[s(o,{value:e.md.year,label:"Year",class:"datePicker",type:"number"},null,8,["value"]),s(o,{value:e.md.month,label:"Month",class:"datePicker"},null,8,["value"]),s(o,{value:e.md.day,label:"Day",class:"datePicker"},null,8,["value"])])):f("",!0),s(o,{value:e.md.original_format,label:"Original Format"},null,8,["value"])])]),r("div",ft,[r("section",_t,[r("div",vt,[s(o,{value:l.pages,label:"Pages"},null,8,["value"]),s(o,{value:e.md.finished,label:"Finished"},null,8,["value"]),s(o,{value:l.ltrText,label:"Reading Direction"},null,8,["value"])])]),r("section",gt,[r("div",bt,[e.md.createdAt?(n(),m(o,{key:0,value:l.formatDateTime(e.md.createdAt),label:"Created at",class:"mtime"},null,8,["value"])):f("",!0),e.md.updatedAt?(n(),m(o,{key:1,value:l.formatDateTime(e.md.updatedAt),label:"Updated at",class:"mtime"},null,8,["value"])):f("",!0),s(o,{value:l.size,label:"Size"},null,8,["value"]),s(o,{value:l.fileType,label:"File Type"},null,8,["value"])]),r("div",yt,[s(o,{group:"f",value:{pk:e.md.parentFolderPk,name:e.md.path},label:"Path"},null,8,["value"])])]),r("section",kt,[s(o,{value:e.md.country,label:"Country"},null,8,["value"]),s(o,{value:e.md.language,label:"Language"},null,8,["value"])]),r("section",Ct,[s(o,{value:e.md.communityRating,label:"Community Rating"},null,8,["value"]),s(o,{value:e.md.criticalRating,label:"Critical Rating"},null,8,["value"]),s(o,{value:e.md.ageRating,label:"Age Rating"},null,8,["value"])]),r("section",St,[s(_,{values:e.md.genres,label:"Genres"},null,8,["values"]),s(_,{values:e.md.tags,label:"Tags"},null,8,["values"]),s(_,{values:e.md.teams,label:"Teams"},null,8,["values"]),s(_,{values:e.md.characters,label:"Characters"},null,8,["values"]),s(_,{values:e.md.locations,label:"Locations"},null,8,["values"]),s(_,{values:e.md.storyArcs,label:"Story Arcs"},null,8,["values"]),s(_,{values:e.md.seriesGroups,label:"Series Groups"},null,8,["values"])]),r("section",wt,[s(o,{value:e.md.web,label:"Web Link",link:!0},null,8,["value"]),s(o,{value:e.md.summary,label:"Summary"},null,8,["value"]),s(o,{value:e.md.comments,label:"Comments"},null,8,["value"]),s(o,{value:e.md.notes,label:"Notes"},null,8,["value"]),s(o,{value:e.md.scanInfo,label:"Scan"},null,8,["value"])]),r("section",Tt,[s(H,{value:e.md.creators},null,8,["value"])])]),r("footer",Pt,[a.group==="c"?(n(),m(w,{key:0,id:"downloadButton",title:"Download Comic Archive",onClick:l.download},{default:c(()=>[a.group==="c"?(n(),m(T,{key:0},{default:c(()=>[v(p(u.mdiDownload),1)]),_:1})):f("",!0),v(" Download ")]),_:1},8,["onClick"])):f("",!0),l.isReadButtonShown?(n(),m(w,{key:1,to:l.readerRoute,title:"Read Comic",disabled:!l.isReadButtonEnabled},{default:c(()=>[s(T,null,{default:c(()=>[v(p(l.readButtonIcon),1)]),_:1}),v(" Read ")]),_:1},8,["to","disabled"])):f("",!0),r("span",It,[s(i,{class:"closeButton",title:"Close Metadata (esc)",size:"x-large",onClick:t[2]||(t[2]=y=>u.dialog=!1)})])])],32)):(n(),h("div",Bt,[s(i,{class:"closeButton",title:"Close Metadata (esc)",onClick:t[4]||(t[4]=y=>u.dialog=!1)}),Rt,s(W,{"model-value":u.progress,indeterminate:u.progress>=100,class:"placeholder"},null,8,["model-value","indeterminate"])]))]),_:1},8,["modelValue"])}const At=g(nt,[["render",Vt],["__scopeId","data-v-f9d6e29f"]]);export{E as P,Lt as _,$t as a,Mt as b,At as c,q as d,st as g,Ne as t};
