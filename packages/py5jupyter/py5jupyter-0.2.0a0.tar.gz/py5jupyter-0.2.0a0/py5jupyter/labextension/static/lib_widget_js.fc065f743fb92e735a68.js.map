{"version":3,"file":"lib_widget_js.fc065f743fb92e735a68.js","mappings":";;;;;;;;;AAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4B,+DAA+D,iBAAiB;AAC5G;AACA,oCAAoC,MAAM,+BAA+B,YAAY;AACrF,mCAAmC,MAAM,mCAAmC,YAAY;AACxF,gCAAgC;AAChC;AACA,KAAK;AACL;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA,0CAA0C,oBAAoB;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,KAAK;AACL;AACA,qBAAqB;AACrB;;;;;;;;;;AChDa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,mBAAmB,GAAG,sBAAsB;AAC5C;AACA;AACA;AACA,aAAa,mBAAO,CAAC,uCAAiB;AACtC;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB;AACtB;AACA;AACA;AACA,mBAAmB;AACnB;;;;;;;;;;ACrCa;AACb;AACA,4BAA4B,+DAA+D,iBAAiB;AAC5G;AACA,oCAAoC,MAAM,+BAA+B,YAAY;AACrF,mCAAmC,MAAM,mCAAmC,YAAY;AACxF,gCAAgC;AAChC;AACA,KAAK;AACL;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,2BAA2B,GAAG,4BAA4B;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,mBAAO,CAAC,oFAAuB;AAC9C,kBAAkB,mBAAO,CAAC,mCAAW;AACrC,gBAAgB,mBAAO,CAAC,+BAAS;AACjC;AACA;AACA;AACA,6CAA6C,uBAAuB,8XAA8X;AAClc;AACA;AACA,4BAA4B;AAC5B,iEAAiE,wCAAwC;AACzG;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,wCAAwC,yDAAyD,+BAA+B;AAChI;AACA;AACA,sDAAsD,2CAA2C,4DAA4D;AAC7J;AACA;AACA;AACA;AACA,sDAAsD,6CAA6C,4DAA4D;AAC/J;AACA;AACA;AACA,sDAAsD,0GAA0G,4DAA4D;AAC5N;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,iBAAiB;AACjB;AACA;AACA,2BAA2B;AAC3B","sources":["webpack://jupyter-py5/./lib/utils.js","webpack://jupyter-py5/./lib/version.js","webpack://jupyter-py5/./lib/widget.js"],"sourcesContent":["\"use strict\";\n// *****************************************************************************\n//\n//   Part of the py5jupyter (& py5) library\n//   Copyright (C) 2022-2023 Jim Schmitz\n//\n//   This library is free software: you can redistribute it and/or modify it\n//   under the terms of the GNU Lesser General Public License as published by\n//   the Free Software Foundation, either version 2.1 of the License, or (at\n//   your option) any later version.\n//\n//   This library is distributed in the hope that it will be useful, but\n//   WITHOUT ANY WARRANTY; without even the implied warranty of\n//   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser\n//   General Public License for more details.\n//\n//   You should have received a copy of the GNU Lesser General Public License\n//   along with this library. If not, see <https://www.gnu.org/licenses/>.\n//\n// *****************************************************************************\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.bufferToImage = void 0;\n// The below function came from the wonderful Python library ipycanvas\n// https://github.com/martinRenou/ipycanvas\nfunction bufferToImage(buffer) {\n    return __awaiter(this, void 0, void 0, function* () {\n        let url;\n        const blob = new Blob([buffer], { type: 'image/jpeg' });\n        url = URL.createObjectURL(blob);\n        const img = new Image();\n        return new Promise(resolve => {\n            img.onload = () => {\n                resolve(img);\n            };\n            img.src = url;\n        });\n    });\n}\nexports.bufferToImage = bufferToImage;\n//# sourceMappingURL=utils.js.map","\"use strict\";\n// *****************************************************************************\n//\n//   Part of the py5jupyter (& py5) library\n//   Copyright (C) 2022-2023 Jim Schmitz\n//\n//   This library is free software: you can redistribute it and/or modify it\n//   under the terms of the GNU Lesser General Public License as published by\n//   the Free Software Foundation, either version 2.1 of the License, or (at\n//   your option) any later version.\n//\n//   This library is distributed in the hope that it will be useful, but\n//   WITHOUT ANY WARRANTY; without even the implied warranty of\n//   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser\n//   General Public License for more details.\n//\n//   You should have received a copy of the GNU Lesser General Public License\n//   along with this library. If not, see <https://www.gnu.org/licenses/>.\n//\n// *****************************************************************************\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.MODULE_NAME = exports.MODULE_VERSION = void 0;\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\n// eslint-disable-next-line @typescript-eslint/no-var-requires\nconst data = require('../package.json');\n/**\n * The _model_module_version/_view_module_version this package implements.\n *\n * The html widget manager assumes that this is the same as the npm package\n * version number.\n */\nexports.MODULE_VERSION = data.version;\n/*\n * The current package name.\n */\nexports.MODULE_NAME = data.name;\n//# sourceMappingURL=version.js.map","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Py5SketchPortalView = exports.Py5SketchPortalModel = void 0;\n// *****************************************************************************\n//\n//   Part of the py5jupyter (& py5) library\n//   Copyright (C) 2022-2023 Jim Schmitz\n//\n//   This library is free software: you can redistribute it and/or modify it\n//   under the terms of the GNU Lesser General Public License as published by\n//   the Free Software Foundation, either version 2.1 of the License, or (at\n//   your option) any later version.\n//\n//   This library is distributed in the hope that it will be useful, but\n//   WITHOUT ANY WARRANTY; without even the implied warranty of\n//   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser\n//   General Public License for more details.\n//\n//   You should have received a copy of the GNU Lesser General Public License\n//   along with this library. If not, see <https://www.gnu.org/licenses/>.\n//\n// *****************************************************************************\nconst base_1 = require(\"@jupyter-widgets/base\");\nconst version_1 = require(\"./version\");\nconst utils_1 = require(\"./utils\");\n// https://ipywidgets.readthedocs.io/en/latest/examples/Widget%20Low%20Level.html\nclass Py5SketchPortalModel extends base_1.DOMWidgetModel {\n    defaults() {\n        return Object.assign(Object.assign({}, super.defaults()), { _model_name: Py5SketchPortalModel.model_name, _model_module: Py5SketchPortalModel.model_module, _model_module_version: Py5SketchPortalModel.model_module_version, _view_name: Py5SketchPortalModel.view_name, _view_module: Py5SketchPortalModel.view_module, _view_module_version: Py5SketchPortalModel.view_module_version, width: '', height: '', value: new DataView(new ArrayBuffer(0)) });\n    }\n}\nexports.Py5SketchPortalModel = Py5SketchPortalModel;\nPy5SketchPortalModel.serializers = Object.assign(Object.assign({}, base_1.DOMWidgetModel.serializers), { value: {\n        serialize: (value) => {\n            return new DataView(value.buffer.slice(0));\n        },\n    } });\nPy5SketchPortalModel.model_name = 'Py5SketchPortalModel';\nPy5SketchPortalModel.model_module = version_1.MODULE_NAME;\nPy5SketchPortalModel.model_module_version = version_1.MODULE_VERSION;\nPy5SketchPortalModel.view_name = 'Py5SketchPortalView';\nPy5SketchPortalModel.view_module = version_1.MODULE_NAME;\nPy5SketchPortalModel.view_module_version = version_1.MODULE_VERSION;\nclass Py5SketchPortalView extends base_1.DOMWidgetView {\n    render() {\n        this._canvas = document.createElement('canvas');\n        this._canvas.width = this.model.get('width');\n        this._canvas.height = this.model.get('height');\n        this._canvas.tabIndex = 0;\n        const ctx = this._canvas.getContext('2d');\n        if (ctx === null) {\n            throw 'Could not create 2d context.';\n        }\n        else {\n            this._ctx = ctx;\n        }\n        this._updateImgSrc();\n        this.el.appendChild(this._canvas);\n        this._canvas.addEventListener('keydown', {\n            handleEvent: this.onKeyEvent.bind(this, 'key_down')\n        });\n        this._canvas.addEventListener('keypress', {\n            handleEvent: this.onKeyEvent.bind(this, 'key_press')\n        });\n        this._canvas.addEventListener('keyup', {\n            handleEvent: this.onKeyEvent.bind(this, 'key_up')\n        });\n        this._canvas.addEventListener('mouseenter', {\n            handleEvent: this.onMouseEvent.bind(this, 'mouse_enter')\n        });\n        this._canvas.addEventListener('mousedown', {\n            handleEvent: this.onMouseDown.bind(this)\n        });\n        this._canvas.addEventListener('mousemove', {\n            handleEvent: this.onMouseEvent.bind(this, 'mouse_move')\n        });\n        this._canvas.addEventListener('mouseup', {\n            handleEvent: this.onMouseEvent.bind(this, 'mouse_up')\n        });\n        this._canvas.addEventListener('mouseleave', {\n            handleEvent: this.onMouseEvent.bind(this, 'mouse_leave')\n        });\n        this._canvas.addEventListener('click', {\n            handleEvent: this.onMouseEvent.bind(this, 'mouse_click')\n        });\n        this._canvas.addEventListener('wheel', {\n            handleEvent: this.onMouseWheel.bind(this)\n        });\n        // Python -> JavaScript update\n        this.model.on('change:value', this._updateImgSrc, this);\n    }\n    _updateImgSrc() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const img = yield utils_1.bufferToImage(this.model.get('value'));\n            this._ctx.drawImage(img, 0, 0);\n        });\n    }\n    // https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent\n    onKeyEvent(event_name, event) {\n        this.model.send(Object.assign({ event: event_name, key: event.key, repeat: event.repeat }, this.getModifiers(event)), {});\n    }\n    onMouseEvent(event_name, event) {\n        this.model.send(Object.assign(Object.assign({ event: event_name, buttons: event.buttons }, this.getModifiers(event)), this.getCoordinates(event)), {});\n    }\n    onMouseDown(event) {\n        // Bring focus to the img element, so keyboard events can be triggered\n        this._canvas.focus();\n        this.model.send(Object.assign(Object.assign({ event: 'mouse_down', buttons: event.buttons }, this.getModifiers(event)), this.getCoordinates(event)), {});\n    }\n    // https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers\n    onMouseWheel(event) {\n        this.model.send(Object.assign(Object.assign({ event: 'mouse_wheel', buttons: event.buttons, wheel: ((event.deltaY != 0) ? event.deltaY : event.deltaX) }, this.getModifiers(event)), this.getCoordinates(event)), {});\n    }\n    getCoordinates(event) {\n        // https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent\n        const rect = this._canvas.getBoundingClientRect();\n        const x = (this._canvas.width * (event.clientX - rect.left)) / rect.width;\n        const y = (this._canvas.height * (event.clientY - rect.top)) / rect.height;\n        return { x, y };\n    }\n    getModifiers(event) {\n        return { mod: (+event.shiftKey) * 1 + (+event.ctrlKey) * 2 + (+event.metaKey) * 4 + (+event.altKey) * 8 };\n    }\n}\nexports.Py5SketchPortalView = Py5SketchPortalView;\n//# sourceMappingURL=widget.js.map"],"names":[],"sourceRoot":""}