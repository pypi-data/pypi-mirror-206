

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Detailed code run &mdash; xagg 2.4 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "document", "processHtmlClass": "math|output_area"}}</script>
    
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../index.html" class="icon icon-home"> xagg
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../intro.html">Intro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../notebooks/base_run.html">Base run</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../notebooks/full_run.html">Detailed code run</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../api_user.html">User API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../api_backend.html">Backend API</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">xagg</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Detailed code run</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../../../_sources/_html/.doctrees/nbsphinx/_html/notebooks/full_run.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Detailed-code-run">
<h1>Detailed code run<a class="headerlink" href="#Detailed-code-run" title="Permalink to this headline">¶</a></h1>
<p>Here is a deep dive in to the <code class="docutils literal notranslate"><span class="pre">xagg</span></code> functionality.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">xagg</span> <span class="k">as</span> <span class="nn">xa</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
</pre></div>
</div>
</div>
<section id="Intro">
<h2>Intro<a class="headerlink" href="#Intro" title="Permalink to this headline">¶</a></h2>
<p>We’ll be aggregating a gridded dataset onto a set of shapefiles, using an extra set of weights. Specifically, we’ll use: - gridded: month-of-year average temperature projections for the end-of-century from a climate model (CCSM4) - shapefiles: US counties - additional weights: global gridded population density (<a class="reference external" href="https://sedac.ciesin.columbia.edu/data/collection/gpw-v4">GPW</a>, 30 min resolution)</p>
<p>This is a setup that you may for example use if projecting the impact of temperature on some human variable (temperature vs. mortality, for example) for which you have data at the US county level. Since your mortality data is likely at the county level, you need to aggregate the gridded climate model output data to counties - i.e., what is the average temperature over each county? This code will calculate which pixels overlap each county - and by how much - allowing an area-averaged value for
monthly temperature at the county level.</p>
<p>However, you also care about where people live - so you’d like to additionally weight your temperature estimate by a population density dataset. This code easily allows such additional weights. The resultant output is a value of temperature for each month at each county, averaged by both the overlap of individual pixels and the population density in those pixels. (<em>NB: GPWv4 just averages a political unit’s population over a pixel grid, so it might not be the best product in this particular use
case, but is used as a sample here</em>)</p>
<p>Let’s get started.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Load some climate data as an xarray dataset</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;../../data/climate_data/tas_Amon_CCSM4_rcp85_monthavg_20700101-20991231.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Load US counties shapefile as a geopandas GeoDataFrame</span>
<span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;../../data/geo_data/UScounties.shp&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Load global gridded population data from GPW</span>
<span class="n">ds_pop</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;../../data/pop_data/pop2000.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><em>NB: the GPW file above has been pre-processed, by subsampling to ``raster=0`` (the 2000 population), and renaming the primary variable to ``pop`` for ease of use.</em></p>
</section>
<section id="Calculating-area-weights-between-a-raster-grid-and-polygons">
<h2>Calculating area weights between a raster grid and polygons<a class="headerlink" href="#Calculating-area-weights-between-a-raster-grid-and-polygons" title="Permalink to this headline">¶</a></h2>
<p>First, <code class="docutils literal notranslate"><span class="pre">xagg</span></code> has to figure out how much each pixel overlaps each polygon. This process requires a few steps:</p>
<ol class="arabic simple" start="0">
<li><p>Get everything in the right format.</p>
<ul class="simple">
<li><p>Gridded data comes in all shapes and sizes. <code class="docutils literal notranslate"><span class="pre">xagg</span></code> is ready to deal with most common grid naming conventions - so no matter if your lat and lon variables are called ‘Latitude’ and ‘Longitude’ or ‘y’ and ‘x’ or many options in between, as long as they’re in xarray Datasets or DataArrays, they’ll work.</p></li>
<li><p>Behind the scenes, longitude values are also forced to -180:180 (from 0:360, if applicable), just to make sure everything is operating in the same coordinate system.</p></li>
</ul>
</li>
<li><p>Build polygons for each pixel</p>
<ul class="simple">
<li><p>To figure out how much each pixel overlaps each polygon, pixel polygons have to be constructed. If your gridded variable already has “lat_bnds” and “lon_bnds” (giving the vertices of each pixel) explicitly included in the <code class="docutils literal notranslate"><span class="pre">xr.Dataset</span></code>, then those are used. If none are found, “lat_bnds” and “lon_bnds” are constructed by assuming the vertices are halfway between the coordinates in degrees.</p></li>
<li><p>If an additional weighting is used, the weighting dataset and your gridded data have to be homogenized at this stage. By default, the weighting dataset is regridded to your gridded data using <code class="docutils literal notranslate"><span class="pre">xesmf</span></code>. Future versions will also allow regridding the gridded data to the weighting dataset here(it’s already accounted for in some of the functions, but not all).</p></li>
<li><p>To avoid creating gigantic geodataframes with pixel polygons, the dataset is by default subset to a bounding box around the shapefiles first. In the aggregating code below, this subsetting is taken into account, and the input <code class="docutils literal notranslate"><span class="pre">ds</span></code> into <code class="docutils literal notranslate"><span class="pre">xa.aggregate</span></code> is matched to the original source grid on which the overlaps were calculated.</p></li>
</ul>
</li>
<li><p>Calculate area overlaps between each pixel and each polygon</p>
<ul class="simple">
<li><p>Now, the overlap between each pixel and each polygon is calculated. Using <code class="docutils literal notranslate"><span class="pre">geopandas</span></code>’ excellent polygon boolean operations and area calculations, the intersection between the raster grid and the polygon is calculated. For each polygon, the coordinates of each pixel that intersects it is saved, as is the relative area of that overlap (as an example, if you had a county the size and shape of one pixel, but located half in one pixel and half in the other pixel, those two pixels would be
saved, and their relative area would be 0.5 each). Areas are calculated using the WGS84 geoid.</p></li>
</ul>
</li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Calculate overlaps</span>
<span class="n">weightmap</span> <span class="o">=</span> <span class="n">xa</span><span class="o">.</span><span class="n">pixel_overlaps</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span><span class="n">gdf</span><span class="p">,</span><span class="n">weights</span><span class="o">=</span><span class="n">ds_pop</span><span class="o">.</span><span class="n">pop</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
creating polygons for each pixel...
regridding weights to data grid...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/kevinschwarzwald/opt/anaconda3/envs/test/lib/python3.9/site-packages/xarray/core/dataarray.py:746: FutureWarning: elementwise comparison failed; returning scalar instead, but in the future will perform elementwise comparison
  return key in self.data
/Users/kevinschwarzwald/opt/anaconda3/envs/test/lib/python3.9/site-packages/xesmf/frontend.py:466: FutureWarning: ``output_sizes`` should be given in the ``dask_gufunc_kwargs`` parameter. It will be removed as direct parameter in a future version.
  dr_out = xr.apply_ufunc(
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
calculating overlaps between pixels and output polygons...
success!
</pre></div></div>
</div>
</section>
<section id="Aggregating-gridded-data-to-the-polygons-using-the-area-weights-(and-other-weights)-calculated-above">
<h2>Aggregating gridded data to the polygons using the area weights (and other weights) calculated above<a class="headerlink" href="#Aggregating-gridded-data-to-the-polygons-using-the-area-weights-(and-other-weights)-calculated-above" title="Permalink to this headline">¶</a></h2>
<p>Now that we know which pixels overlap which polygons and by how much (and what the value of the population weight for each pixel is), it’s time to aggregate data to the polygon level. <code class="docutils literal notranslate"><span class="pre">xagg</span></code> will assume that all variables in the original <code class="docutils literal notranslate"><span class="pre">ds</span></code> that have <code class="docutils literal notranslate"><span class="pre">lat</span></code> and <code class="docutils literal notranslate"><span class="pre">lon</span></code> coordinates should be aggregated. These variables may have extra dimensions (3-D variables (i.e. <code class="docutils literal notranslate"><span class="pre">lon</span> <span class="pre">x</span> <span class="pre">lat</span> <span class="pre">x</span> <span class="pre">time</span></code>) are supported; 4-D etc. <em>should</em> be supported but haven’t been tested yet - the biggest issue may be in
exporting).</p>
<p>Since we included an additional weighting grid, this dataset is included in <code class="docutils literal notranslate"><span class="pre">weightmap</span></code> from above and is seamlessly integrated into the weighting scheme.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Aggregate</span>
<span class="n">aggregated</span> <span class="o">=</span> <span class="n">xa</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span><span class="n">weightmap</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
adjusting grid... (this may happen because only a subset of pixels were used for aggregation for efficiency - i.e. [subset_bbox=True] in xa.pixel_overlaps())
grid adjustment successful
aggregating tas...
all variables aggregated to polygons!
</pre></div></div>
</div>
</section>
<section id="Converting-aggregated-data">
<h2>Converting aggregated data<a class="headerlink" href="#Converting-aggregated-data" title="Permalink to this headline">¶</a></h2>
<p>Now that the data is aggregated, we want it in a useable format.</p>
<p>Supported formats for converting include: - <code class="docutils literal notranslate"><span class="pre">xarray</span></code> Dataset (using <code class="docutils literal notranslate"><span class="pre">.to_dataset()</span></code>) - Grid dimensions from the original dataset are replaced with a single dimensions for polygons - by default called “poly_idx” (change this with the <code class="docutils literal notranslate"><span class="pre">loc_dim=...</span></code> option). Aggregated variables keep their non-grid dimensions unchanged; with their grid dimension replaced as above. - All original fields from the <code class="docutils literal notranslate"><span class="pre">geodataframe</span></code> are kept as <code class="docutils literal notranslate"><span class="pre">poly_idx</span> <span class="pre">x</span> <span class="pre">1</span></code> variables. - <code class="docutils literal notranslate"><span class="pre">pandas</span></code> Dataframe (using
<code class="docutils literal notranslate"><span class="pre">.to_dataframe()</span></code>) - All original fields from the <code class="docutils literal notranslate"><span class="pre">geodataframe</span></code> are kept; the aggregated variables are added as separate columns. If the aggregated variables have a 3rd dimension, they are reshaped long - with procedurally generated column names (just <code class="docutils literal notranslate"><span class="pre">[var]0</span></code>, <code class="docutils literal notranslate"><span class="pre">[var]1</span></code>, … for now).</p>
<p>(the “raw” form of the geodataframe used to create these can also be directly accessed through <code class="docutils literal notranslate"><span class="pre">aggregated.agg</span></code>)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Example as a dataset</span>
<span class="n">ds_out</span> <span class="o">=</span> <span class="n">aggregated</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">()</span>
<span class="n">ds_out</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:     (month: 12, pix_idx: 3141)
Coordinates:
  * pix_idx     (pix_idx) int64 0 1 2 3 4 5 6 ... 3135 3136 3137 3138 3139 3140
  * month       (month) int64 1 2 3 4 5 6 7 8 9 10 11 12
Data variables:
    NAME        (pix_idx) object &#x27;Lake of the Woods&#x27; &#x27;Ferry&#x27; ... &#x27;Broomfield&#x27;
    STATE_NAME  (pix_idx) object &#x27;Minnesota&#x27; &#x27;Washington&#x27; ... &#x27;Colorado&#x27;
    STATE_FIPS  (pix_idx) object &#x27;27&#x27; &#x27;53&#x27; &#x27;53&#x27; &#x27;53&#x27; ... &#x27;02&#x27; &#x27;02&#x27; &#x27;02&#x27; &#x27;08&#x27;
    CNTY_FIPS   (pix_idx) object &#x27;077&#x27; &#x27;019&#x27; &#x27;065&#x27; &#x27;047&#x27; ... &#x27;240&#x27; &#x27;068&#x27; &#x27;014&#x27;
    FIPS        (pix_idx) object &#x27;27077&#x27; &#x27;53019&#x27; &#x27;53065&#x27; ... &#x27;02068&#x27; &#x27;08014&#x27;
    tas         (pix_idx, month) float64 264.0 268.9 274.0 ... 283.5 276.4 270.4</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-61bbd9cd-6f0c-4594-bb01-037ef123d15c' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-61bbd9cd-6f0c-4594-bb01-037ef123d15c' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>month</span>: 12</li><li><span class='xr-has-index'>pix_idx</span>: 3141</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-6e0a2ea6-4710-48d9-b953-a05a28cdadb5' class='xr-section-summary-in' type='checkbox'  checked><label for='section-6e0a2ea6-4710-48d9-b953-a05a28cdadb5' class='xr-section-summary' >Coordinates: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>pix_idx</span></div><div class='xr-var-dims'>(pix_idx)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0 1 2 3 4 ... 3137 3138 3139 3140</div><input id='attrs-4d2bb7c0-ad03-47c3-a77c-4e127f6a3980' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-4d2bb7c0-ad03-47c3-a77c-4e127f6a3980' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-94142a70-8981-43f2-9f77-576947cd1c36' class='xr-var-data-in' type='checkbox'><label for='data-94142a70-8981-43f2-9f77-576947cd1c36' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([   0,    1,    2, ..., 3138, 3139, 3140])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>month</span></div><div class='xr-var-dims'>(month)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1 2 3 4 5 6 7 8 9 10 11 12</div><input id='attrs-5f9c5863-be53-4362-b177-448b403f2706' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-5f9c5863-be53-4362-b177-448b403f2706' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7a56bf74-9ee2-4db8-8e38-def1602167d6' class='xr-var-data-in' type='checkbox'><label for='data-7a56bf74-9ee2-4db8-8e38-def1602167d6' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([ 1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-c989583b-6e96-487d-bd9b-3451238cbc26' class='xr-section-summary-in' type='checkbox'  checked><label for='section-c989583b-6e96-487d-bd9b-3451238cbc26' class='xr-section-summary' >Data variables: <span>(6)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>NAME</span></div><div class='xr-var-dims'>(pix_idx)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;Lake of the Woods&#x27; ... &#x27;Broomfi...</div><input id='attrs-66252898-8590-4be3-b178-752dba91618a' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-66252898-8590-4be3-b178-752dba91618a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c748084f-0936-452c-b971-b9912ffd315d' class='xr-var-data-in' type='checkbox'><label for='data-c748084f-0936-452c-b971-b9912ffd315d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;Lake of the Woods&#x27;, &#x27;Ferry&#x27;, &#x27;Stevens&#x27;, ...,
       &#x27;Southeast Fairbanks&#x27;, &#x27;Denali&#x27;, &#x27;Broomfield&#x27;], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>STATE_NAME</span></div><div class='xr-var-dims'>(pix_idx)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;Minnesota&#x27; ... &#x27;Colorado&#x27;</div><input id='attrs-ae5f1bb7-b967-4ea2-8933-e4e9977c528f' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-ae5f1bb7-b967-4ea2-8933-e4e9977c528f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6f4f0db2-6418-4668-b815-fe77a9ec58a8' class='xr-var-data-in' type='checkbox'><label for='data-6f4f0db2-6418-4668-b815-fe77a9ec58a8' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;Minnesota&#x27;, &#x27;Washington&#x27;, &#x27;Washington&#x27;, ..., &#x27;Alaska&#x27;, &#x27;Alaska&#x27;,
       &#x27;Colorado&#x27;], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>STATE_FIPS</span></div><div class='xr-var-dims'>(pix_idx)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;27&#x27; &#x27;53&#x27; &#x27;53&#x27; ... &#x27;02&#x27; &#x27;02&#x27; &#x27;08&#x27;</div><input id='attrs-4210d0c7-a77c-46b4-ab36-e86d00a51b68' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-4210d0c7-a77c-46b4-ab36-e86d00a51b68' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-2ad423d7-4484-4cf7-aeeb-ae96750d7014' class='xr-var-data-in' type='checkbox'><label for='data-2ad423d7-4484-4cf7-aeeb-ae96750d7014' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;27&#x27;, &#x27;53&#x27;, &#x27;53&#x27;, ..., &#x27;02&#x27;, &#x27;02&#x27;, &#x27;08&#x27;], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>CNTY_FIPS</span></div><div class='xr-var-dims'>(pix_idx)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;077&#x27; &#x27;019&#x27; &#x27;065&#x27; ... &#x27;068&#x27; &#x27;014&#x27;</div><input id='attrs-1c2f2ad5-c0b6-4fa5-aa56-59d40b66aebd' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-1c2f2ad5-c0b6-4fa5-aa56-59d40b66aebd' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-322a4c28-93e8-474f-9847-93264bfd99c1' class='xr-var-data-in' type='checkbox'><label for='data-322a4c28-93e8-474f-9847-93264bfd99c1' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;077&#x27;, &#x27;019&#x27;, &#x27;065&#x27;, ..., &#x27;240&#x27;, &#x27;068&#x27;, &#x27;014&#x27;], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>FIPS</span></div><div class='xr-var-dims'>(pix_idx)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;27077&#x27; &#x27;53019&#x27; ... &#x27;02068&#x27; &#x27;08014&#x27;</div><input id='attrs-55d940a9-a3c2-4167-87e8-c16603a3a61f' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-55d940a9-a3c2-4167-87e8-c16603a3a61f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-2d6778ad-5dd1-4537-bd20-f96364cfa35e' class='xr-var-data-in' type='checkbox'><label for='data-2d6778ad-5dd1-4537-bd20-f96364cfa35e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;27077&#x27;, &#x27;53019&#x27;, &#x27;53065&#x27;, ..., &#x27;02240&#x27;, &#x27;02068&#x27;, &#x27;08014&#x27;],
      dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>tas</span></div><div class='xr-var-dims'>(pix_idx, month)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>264.0 268.9 274.0 ... 276.4 270.4</div><input id='attrs-2cc0790b-1fda-492b-972c-0a1e5f6d59df' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-2cc0790b-1fda-492b-972c-0a1e5f6d59df' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-0e2232d4-95a5-46a0-a2a2-4330b086a917' class='xr-var-data-in' type='checkbox'><label for='data-0e2232d4-95a5-46a0-a2a2-4330b086a917' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[263.9780062 , 268.88786769, 274.01215237, ..., 283.81523287,
        275.1416336 , 266.05442984],
       [271.78043992, 275.61848506, 276.93418312, ..., 281.63345613,
        276.71447491, 272.24200396],
       [273.2172504 , 276.94037995, 278.41422511, ..., 283.27395604,
        278.0632773 , 273.66618058],
       ...,
       [263.91916835, 263.8990788 , 266.77151431, ..., 272.37796292,
        265.7020255 , 264.41430223],
       [265.04959892, 264.79484859, 268.19315553, ..., 273.14260516,
        266.53491609, 265.57515291],
       [270.80386353, 273.4302063 , 275.95550537, ..., 283.54470825,
        276.38360596, 270.44485474]])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-c1f54a35-eca3-4519-afc0-89fb25925e38' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-c1f54a35-eca3-4519-afc0-89fb25925e38' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Example as a dataframe</span>
<span class="n">df_out</span> <span class="o">=</span> <span class="n">aggregated</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
<span class="n">df_out</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NAME</th>
      <th>STATE_NAME</th>
      <th>STATE_FIPS</th>
      <th>CNTY_FIPS</th>
      <th>FIPS</th>
      <th>tas0</th>
      <th>tas1</th>
      <th>tas2</th>
      <th>tas3</th>
      <th>tas4</th>
      <th>tas5</th>
      <th>tas6</th>
      <th>tas7</th>
      <th>tas8</th>
      <th>tas9</th>
      <th>tas10</th>
      <th>tas11</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Lake of the Woods</td>
      <td>Minnesota</td>
      <td>27</td>
      <td>077</td>
      <td>27077</td>
      <td>263.978006</td>
      <td>268.887868</td>
      <td>274.012152</td>
      <td>283.158717</td>
      <td>290.630598</td>
      <td>297.850779</td>
      <td>302.038199</td>
      <td>300.327744</td>
      <td>293.465816</td>
      <td>283.815233</td>
      <td>275.141634</td>
      <td>266.054430</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Ferry</td>
      <td>Washington</td>
      <td>53</td>
      <td>019</td>
      <td>53019</td>
      <td>271.780440</td>
      <td>275.618485</td>
      <td>276.934183</td>
      <td>279.826777</td>
      <td>286.621100</td>
      <td>293.757010</td>
      <td>299.056368</td>
      <td>297.131708</td>
      <td>289.844308</td>
      <td>281.633456</td>
      <td>276.714475</td>
      <td>272.242004</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Stevens</td>
      <td>Washington</td>
      <td>53</td>
      <td>065</td>
      <td>53065</td>
      <td>273.217250</td>
      <td>276.940380</td>
      <td>278.414225</td>
      <td>281.319652</td>
      <td>287.817911</td>
      <td>294.926457</td>
      <td>300.903109</td>
      <td>299.304529</td>
      <td>292.245363</td>
      <td>283.273956</td>
      <td>278.063277</td>
      <td>273.666181</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Okanogan</td>
      <td>Washington</td>
      <td>53</td>
      <td>047</td>
      <td>53047</td>
      <td>271.831071</td>
      <td>275.586124</td>
      <td>276.689357</td>
      <td>279.324166</td>
      <td>285.771338</td>
      <td>292.635899</td>
      <td>297.756402</td>
      <td>295.956748</td>
      <td>289.177685</td>
      <td>281.440422</td>
      <td>276.654779</td>
      <td>272.275232</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Pend Oreille</td>
      <td>Washington</td>
      <td>53</td>
      <td>051</td>
      <td>53051</td>
      <td>272.092353</td>
      <td>275.888818</td>
      <td>277.346070</td>
      <td>280.446389</td>
      <td>287.268406</td>
      <td>294.357705</td>
      <td>299.851527</td>
      <td>297.965815</td>
      <td>290.622763</td>
      <td>282.058301</td>
      <td>276.996473</td>
      <td>272.484589</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3136</th>
      <td>Skagway-Hoonah-Angoon</td>
      <td>Alaska</td>
      <td>02</td>
      <td>232</td>
      <td>02232</td>
      <td>273.605147</td>
      <td>275.477240</td>
      <td>276.792992</td>
      <td>279.194054</td>
      <td>283.764519</td>
      <td>288.635583</td>
      <td>290.038044</td>
      <td>289.689574</td>
      <td>286.058608</td>
      <td>280.958010</td>
      <td>276.904109</td>
      <td>274.048888</td>
    </tr>
    <tr>
      <th>3137</th>
      <td>Yukon-Koyukuk</td>
      <td>Alaska</td>
      <td>02</td>
      <td>290</td>
      <td>02290</td>
      <td>264.534558</td>
      <td>264.088869</td>
      <td>267.621423</td>
      <td>273.426228</td>
      <td>281.649435</td>
      <td>289.319370</td>
      <td>288.936030</td>
      <td>286.209616</td>
      <td>280.807791</td>
      <td>273.683875</td>
      <td>266.722855</td>
      <td>265.538685</td>
    </tr>
    <tr>
      <th>3138</th>
      <td>Southeast Fairbanks</td>
      <td>Alaska</td>
      <td>02</td>
      <td>240</td>
      <td>02240</td>
      <td>263.919168</td>
      <td>263.899079</td>
      <td>266.771514</td>
      <td>272.144709</td>
      <td>279.739283</td>
      <td>287.625174</td>
      <td>287.933732</td>
      <td>285.436821</td>
      <td>279.768225</td>
      <td>272.377963</td>
      <td>265.702026</td>
      <td>264.414302</td>
    </tr>
    <tr>
      <th>3139</th>
      <td>Denali</td>
      <td>Alaska</td>
      <td>02</td>
      <td>068</td>
      <td>02068</td>
      <td>265.049599</td>
      <td>264.794849</td>
      <td>268.193156</td>
      <td>273.612534</td>
      <td>281.097223</td>
      <td>288.917064</td>
      <td>288.898311</td>
      <td>286.233612</td>
      <td>280.504391</td>
      <td>273.142605</td>
      <td>266.534916</td>
      <td>265.575153</td>
    </tr>
    <tr>
      <th>3140</th>
      <td>Broomfield</td>
      <td>Colorado</td>
      <td>08</td>
      <td>014</td>
      <td>08014</td>
      <td>270.803864</td>
      <td>273.430206</td>
      <td>275.955505</td>
      <td>280.790070</td>
      <td>287.303619</td>
      <td>292.830048</td>
      <td>297.615662</td>
      <td>297.646820</td>
      <td>292.368988</td>
      <td>283.544708</td>
      <td>276.383606</td>
      <td>270.444855</td>
    </tr>
  </tbody>
</table>
<p>3141 rows × 17 columns</p>
</div></div>
</div>
</section>
<section id="Exporting-aggregated-data">
<h2>Exporting aggregated data<a class="headerlink" href="#Exporting-aggregated-data" title="Permalink to this headline">¶</a></h2>
<p>For reproducability and code simplicity, you will likely want to save your aggregated data. In addtion, many researchers use multiple languages or software packages as part of their workflow; for example, STATA or R for regression analysis, or QGIS for spatial analysis, and need to be able to transfer their work to these other environments.</p>
<p><code class="docutils literal notranslate"><span class="pre">xagg</span></code> has built-in export functions that allow the export of aggregated data to: - NetCDF - csv (for use in STATA, R) - shapefile (for use in GIS applications)</p>
<section id="Export-to-netCDF">
<h3>Export to netCDF<a class="headerlink" href="#Export-to-netCDF" title="Permalink to this headline">¶</a></h3>
<p>The netCDF export functionality saves all aggregated variables by replacing the grid dimensions (<code class="docutils literal notranslate"><span class="pre">lat</span></code>, <code class="docutils literal notranslate"><span class="pre">lon</span></code>) with a single location dimension (called <code class="docutils literal notranslate"><span class="pre">poly_idx</span></code>, but this can be changed with the <code class="docutils literal notranslate"><span class="pre">loc_dim=</span></code> argument).</p>
<p>Other dimensions (e.g. <code class="docutils literal notranslate"><span class="pre">time</span></code>) are kept as they were originally in the grid variable.</p>
<p>Fields in the inputted polygons (e.g., FIPS codes for the US Counties shapefile used here) are saved as additional variables. Attributes from the original <code class="docutils literal notranslate"><span class="pre">xarray</span></code> structure are kept.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Export to netcdf</span>
<span class="n">aggregated</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="s1">&#39;file_out.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Export-to-.csv">
<h3>Export to .csv<a class="headerlink" href="#Export-to-.csv" title="Permalink to this headline">¶</a></h3>
<p>The .csv output functionality saves files in a polygon (rows) vs. variables (columns) format. Each aggregated variable and each field in the original inputted polygons are saved as columns. Named attributes in the inputted netcdf file are not included.</p>
<p>Currently .csvs are only saved “wide” - i.e., a <code class="docutils literal notranslate"><span class="pre">lat</span> <span class="pre">x</span> <span class="pre">lon</span> <span class="pre">x</span> <span class="pre">time</span></code> variable <code class="docutils literal notranslate"><span class="pre">tas</span></code>, aggregated to <code class="docutils literal notranslate"><span class="pre">location</span> <span class="pre">x</span> <span class="pre">time</span></code>, would be reshaped wide so that each timestep is saved in its own column, named <code class="docutils literal notranslate"><span class="pre">tas0</span></code>, <code class="docutils literal notranslate"><span class="pre">tas1</span></code>, and so forth.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Export to csv</span>
<span class="n">aggregated</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;file_out.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Export-to-shapefile">
<h3>Export to shapefile<a class="headerlink" href="#Export-to-shapefile" title="Permalink to this headline">¶</a></h3>
<p>The shapefile export functionality keeps the geometry of the originally input polygons, and adds the aggregated variables as fields.</p>
<p>Similar to .csv export above, if aggregated variables have a dimension beyond their location dimensions (e.g., <code class="docutils literal notranslate"><span class="pre">time</span></code>), each step in that dimension is saved in a separate field, named after the variable and the integer of the index along that dimension (e.g., <code class="docutils literal notranslate"><span class="pre">tas0</span></code>, <code class="docutils literal notranslate"><span class="pre">tas1</span></code>, etc. for a variable <code class="docutils literal notranslate"><span class="pre">tas</span></code>).</p>
<p>Named attributes in the inputted netcdf file are not included.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Export to csv</span>
<span class="n">aggregated</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;file_out.shp&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
</section>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Kevin Schwarzwald.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>