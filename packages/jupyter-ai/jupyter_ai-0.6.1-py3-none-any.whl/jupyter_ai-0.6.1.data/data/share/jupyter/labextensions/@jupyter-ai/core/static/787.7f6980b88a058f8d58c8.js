"use strict";(self.webpackChunk_jupyter_ai_core=self.webpackChunk_jupyter_ai_core||[]).push([[787],{65787:(e,t,n)=>{n.r(t),n.d(t,{default:()=>te});var o=n(45687),r=n(35059),s=n(56271),i=n.n(s),l=n(73033),a=n(18377),c=n(71893),u=n(10492);function d(e){return getComputedStyle(document.body).getPropertyValue(e).trim()}function p(e){const[t,n]=(0,s.useState)((0,c.Z)());return(0,s.useEffect)((()=>{!async function(){n(await async function(){await async function(){for(;!document.body.hasAttribute("data-jp-theme-light");)await new Promise((e=>setTimeout(e,100)))}();const e=document.body.getAttribute("data-jp-theme-light");return(0,c.Z)({spacing:4,components:{MuiButton:{defaultProps:{size:"small"}},MuiFilledInput:{defaultProps:{margin:"dense"}},MuiFormControl:{defaultProps:{margin:"dense",size:"small"}},MuiFormHelperText:{defaultProps:{margin:"dense"}},MuiIconButton:{defaultProps:{size:"small"}},MuiInputBase:{defaultProps:{margin:"dense",size:"small"}},MuiInputLabel:{defaultProps:{margin:"dense"}},MuiListItem:{defaultProps:{dense:!0}},MuiOutlinedInput:{defaultProps:{margin:"dense"}},MuiFab:{defaultProps:{size:"small"}},MuiTable:{defaultProps:{size:"small"}},MuiTextField:{defaultProps:{margin:"dense",size:"small"}},MuiToolbar:{defaultProps:{variant:"dense"}}},palette:{background:{paper:d("--jp-layout-color1"),default:d("--jp-layout-color1")},mode:"true"===e?"light":"dark",primary:{main:d("--jp-brand-color1"),light:d("--jp-brand-color2"),dark:d("--jp-brand-color0")},error:{main:d("--jp-error-color1"),light:d("--jp-error-color2"),dark:d("--jp-error-color0")},warning:{main:d("--jp-warn-color1"),light:d("--jp-warn-color2"),dark:d("--jp-warn-color0")},success:{main:d("--jp-success-color1"),light:d("--jp-success-color2"),dark:d("--jp-success-color0")},text:{primary:d("--jp-ui-font-color1"),secondary:d("--jp-ui-font-color2"),disabled:d("--jp-ui-font-color3")}},shape:{borderRadius:2},typography:{fontFamily:d("--jp-ui-font-family"),fontSize:12,htmlFontSize:16,button:{textTransform:"capitalize"}}})}())}()}),[]),i().createElement(u.Z,{theme:t},e.children)}var h,m=n(13191),g=n(45275),f=n(77986),v=n(48942),y=n.n(v),x=n(96707),b=n.n(x),w=n(40532),E=n.n(w),S=(n(38662),n(72647)),C=n(93528);function j({className:e,children:t,...n}){return i().createElement("code",Object.assign({},n,{className:e}),t)}!function(e){e[e.None=0]="None",e[e.Copying=1]="Copying",e[e.Copied=2]="Copied"}(h||(h={}));const _={[h.None]:"Copy to clipboard",[h.Copying]:"Copying...",[h.Copied]:"Copied!"};function k({language:e,children:t,...n}){const o=(0,s.useMemo)((()=>String(t).replace(/\n$/,"")),[t]),[r,l]=(0,s.useState)(h.None);return i().createElement(m.Box,{sx:{display:"flex",flexDirection:"column"}},i().createElement(S.Prism,Object.assign({},n,{children:o,style:C.Z,language:e,PreTag:"div"})),i().createElement(m.Button,{onClick:async()=>{l(h.Copying);try{await navigator.clipboard.writeText(o)}catch(e){return console.error(e),void l(h.None)}l(h.Copied),setTimeout((()=>l(h.None)),1e3)},disabled:r!==h.None,sx:{alignSelf:"flex-end"}},_[r]))}function I({inline:e,className:t,...n}){const o=/language-(\w+)/.exec(t||"");return e?i().createElement(j,Object.assign({},n)):i().createElement(k,Object.assign({},n,{language:o?o[1]:void 0}))}const P=i().createContext({});function M({globalAwareness:e,children:t}){const[n,o]=(0,s.useState)({});return(0,s.useEffect)((()=>{function t(){var t;const n=null!==(t=null==e?void 0:e.getStates())&&void 0!==t?t:new Map,r={};n.forEach((e=>{r[e.user.username]=e.user})),o(r)}return null==e||e.on("change",t),()=>{null==e||e.off("change",t)}}),[e]),e?i().createElement(P.Provider,{value:n},t):t}function A(e){var t;const n=(0,s.useContext)(P),o={height:"24px",width:"24px"};let r;if("human"===e.message.type){const s=null===(t=null==n?void 0:n[e.message.client.username])||void 0===t?void 0:t.color;r=i().createElement(m.Avatar,{sx:{...o,...s&&{bgcolor:s}}},i().createElement(m.Typography,{sx:{fontSize:"var(--jp-ui-font-size1)",color:"var(--jp-ui-inverse-font-color1)"}},e.message.client.initials))}else r=i().createElement(m.Avatar,{sx:{...o,bgcolor:"var(--jp-jupyter-icon-color)"}},i().createElement(g.Z,null));const l="human"===e.message.type?e.message.client.display_name:"Jupyter AI";return i().createElement(m.Box,{sx:{display:"flex",alignItems:"center","& > :not(:last-child)":{marginRight:3},...e.sx}},r,i().createElement(m.Box,{sx:{display:"flex",flexGrow:1,flexWrap:"wrap",justifyContent:"space-between",alignItems:"center"}},i().createElement(m.Typography,{sx:{fontWeight:700,color:"var(--jp-ui-font-color1)"}},l),i().createElement(m.Typography,{sx:{fontSize:"0.8em",color:"var(--jp-ui-font-color2)",fontWeight:300}},e.timestamp)))}function z(e){const[t,n]=(0,s.useState)({});return(0,s.useEffect)((()=>{function t(){const t={};for(const n of e.messages)t[n.id]=(0,f.formatDistanceToNowStrict)((0,f.fromUnixTime)(n.time))+" ago";n(t)}t();const o=setInterval(t,5e3);return()=>{clearInterval(o)}}),[e.messages]),i().createElement(m.Box,{sx:{"& > :not(:last-child)":{borderBottom:"1px solid var(--jp-border-color2)"}}},e.messages.map(((e,n)=>i().createElement(m.Box,{key:n,sx:{padding:4}},i().createElement(A,{message:e,timestamp:t[e.id],sx:{marginBottom:3}}),i().createElement(y(),{className:"jp-RenderedHTMLCommon jp-ai-react-markdown",components:{code:I},remarkPlugins:[b()],rehypePlugins:[E()]},e.body)))))}var L=n(26307);function B(e){return i().createElement(m.Box,{sx:e.sx},i().createElement(m.Box,{sx:{display:"flex"}},i().createElement(m.TextField,{value:e.value,onChange:t=>e.onChange(t.target.value),fullWidth:!0,variant:"outlined",multiline:!0,onKeyDown:function(t){"Enter"===t.key&&t.shiftKey&&(e.onSend(),t.stopPropagation(),t.preventDefault())},InputProps:{endAdornment:i().createElement(m.InputAdornment,{position:"end"},i().createElement(m.IconButton,{size:"small",color:"primary",onClick:e.onSend,disabled:!e.value.trim().length},i().createElement(L.Z,null)))}})),e.hasSelection&&i().createElement(m.FormGroup,{sx:{display:"flex",flexDirection:"row"}},i().createElement(m.FormControlLabel,{control:i().createElement(m.Checkbox,{checked:e.includeSelection,onChange:e.toggleIncludeSelection}),label:"Include selection"}),i().createElement(m.FormControlLabel,{control:i().createElement(m.Checkbox,{checked:e.replaceSelection,onChange:e.toggleReplaceSelection}),label:"Replace selection"})))}const R=i().createContext([null,()=>{}]);function T({selectionWatcher:e,children:t}){const[n,o]=(0,s.useState)(null);(0,s.useEffect)((()=>{e.selectionChanged.connect(((e,t)=>{o(t)}))}),[]);const r=(0,s.useCallback)((t=>{e.replaceSelection(t)}),[e]);return i().createElement(R.Provider,{value:[n,r]},t)}function D(e){const t=(0,s.useMemo)((()=>"jupyter-ai-scroll-container-"+Date.now().toString()),[]);return(0,s.useEffect)((()=>{const e=document.querySelector(`#${t}`);if(!e)return;const n=new IntersectionObserver((t=>{t.forEach((t=>{t.isIntersecting&&e.scroll({top:999999999})}))}),{threshold:1});return n.observe(e),()=>n.disconnect()}),[]),i().createElement(m.Box,{id:t,sx:{overflowY:"scroll","& *":{overflowAnchor:"none"},...e.sx}},i().createElement(m.Box,{sx:{minHeight:"100.01%"}},e.children),i().createElement(m.Box,{sx:{overflowAnchor:"auto",height:"1px"}}))}function N({chatHandler:e}){const[t,n]=(0,s.useState)([]),[o,r]=(0,s.useState)(!0),[l,c]=(0,s.useState)(!1),[u,d]=(0,s.useState)(""),[p,h]=(0,s.useContext)(R);return(0,s.useEffect)((()=>{!async function(){try{const t=await e.getHistory();n(t.messages)}catch(e){}}()}),[e]),(0,s.useEffect)((()=>{function t(e){"connection"!==e.type&&("clear"!==e.type?n((t=>[...t,e])):n([]))}return e.addListener(t),function(){e.removeListener(t)}}),[e]),i().createElement(a.Z,{sx:{width:"100%",height:"100%",boxSizing:"border-box",background:"var(--jp-layout-color0)",display:"flex",flexDirection:"column"}},i().createElement(D,{sx:{flexGrow:1}},i().createElement(z,{messages:t}),i().createElement(a.Z,{sx:{overflowAnchor:"auto",height:"1px"}})),i().createElement(B,{value:u,onChange:d,onSend:async()=>{d("");const t=u+(o&&(null==p?void 0:p.text)?"\n\n```\n"+p.text+"```":""),n=await e.sendMessage({prompt:t}),r=await e.replyFor(n);if(l&&p){const{cellId:e,...t}=p;h({...t,...e&&{cellId:e},text:r.body})}},hasSelection:!!(null==p?void 0:p.text),includeSelection:o,toggleIncludeSelection:()=>r((e=>!e)),replaceSelection:l,toggleReplaceSelection:()=>c((e=>!e)),sx:{paddingLeft:4,paddingRight:4,paddingTop:2,paddingBottom:2,borderTop:"1px solid var(--jp-border-color1)"}}))}function F(e){return i().createElement(p,null,i().createElement(T,{selectionWatcher:e.selectionWatcher},i().createElement(M,{globalAwareness:e.globalAwareness},i().createElement(N,{chatHandler:e.chatHandler}))))}var O=n(22502);new O.LabIcon({name:"jupyter-ai::psychology",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" class="css-10cscxr" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="PsychologyIcon">\n    <path d="M13 8.57c-.79 0-1.43.64-1.43 1.43s.64 1.43 1.43 1.43 1.43-.64 1.43-1.43-.64-1.43-1.43-1.43z"></path><path d="M13 3C9.25 3 6.2 5.94 6.02 9.64L4.1 12.2c-.25.33-.01.8.4.8H6v3c0 1.1.9 2 2 2h1v3h7v-4.68c2.36-1.12 4-3.53 4-6.32 0-3.87-3.13-7-7-7zm3 7c0 .13-.01.26-.02.39l.83.66c.08.06.1.16.05.25l-.8 1.39c-.05.09-.16.12-.24.09l-.99-.4c-.21.16-.43.29-.67.39L14 13.83c-.01.1-.1.17-.2.17h-1.6c-.1 0-.18-.07-.2-.17l-.15-1.06c-.25-.1-.47-.23-.68-.39l-.99.4c-.09.03-.2 0-.25-.09l-.8-1.39c-.05-.08-.03-.19.05-.25l.84-.66c-.01-.13-.02-.26-.02-.39s.02-.27.04-.39l-.85-.66c-.08-.06-.1-.16-.05-.26l.8-1.38c.05-.09.15-.12.24-.09l1 .4c.2-.15.43-.29.67-.39L12 6.17c.02-.1.1-.17.2-.17h1.6c.1 0 .18.07.2.17l.15 1.06c.24.1.46.23.67.39l1-.4c.09-.03.2 0 .24.09l.8 1.38c.05.09.03.2-.05.26l-.85.66c.03.12.04.25.04.39z">\n    </path>\n</svg>'});const W=new O.LabIcon({name:"jupyter-ai::chat",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px">\n  <g class="jp-icon3" fill="#616161">\n    <path d="M0 0h24v24H0V0z" fill="none"/>\n    <path d="M15 4v7H5.17L4 12.17V4h11m1-2H3c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1zm5 4h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1z"/>\n  </g>\n</svg>\n'});var H=n(80819),J=n(26413),Z=n(51473),U=n(41123),V=n(78918),G=n(71840);function $(e){var t;if(!(e instanceof H.DocumentWidget))return null;let n;const{content:o}=e;return o instanceof Z.FileEditor?n=o.editor:o instanceof U.Notebook&&(n=null===(t=o.activeCell)||void 0===t?void 0:t.editor),n instanceof J.CodeMirrorEditor?n:void 0}class Q{constructor(e){if(this._mainAreaWidget=null,this._selection=null,this._selectionChanged=new G.Signal(this),!(e instanceof o.LabShell))throw"Shell is not an instance of LabShell. Jupyter AI does not currently support custom shells.";this._shell=e,this._shell.currentChanged.connect(((e,t)=>{this._mainAreaWidget=t.newValue})),setInterval(this._poll.bind(this),200)}get selectionChanged(){return this._selectionChanged}replaceSelection(e){const t=(0,V.find)(this._shell.widgets(),(t=>t.id===e.widgetId));if(!(t instanceof H.DocumentWidget))return;if(this._shell.activateById(e.widgetId),t.content instanceof U.Notebook&&e.cellId){const n=function(e,t){var n;const o=null===(n=e.model)||void 0===n?void 0:n.sharedModel.cells.findIndex((e=>e.getId()===t));return void 0===o?-1:o}(t.content,e.cellId);-1!==n&&(t.content.activeCellIndex=n)}const n=$(t);if(!n)return;n.model.sharedModel.updateSource(n.getOffsetAt(e.start),n.getOffsetAt(e.end),e.text);const o=n.getPositionAt(n.getOffsetAt(e.start)+e.text.length);n.setSelection({start:o,end:o})}_poll(){const e=this._selection,t=function(e){var t;const n=$(e);if(!(n&&e instanceof H.DocumentWidget))return null;let o;e.content instanceof U.Notebook&&(o=null===(t=e.content.activeCell)||void 0===t?void 0:t.model.id);let{start:r,end:s,...i}=n.getSelection();const l=n.getOffsetAt(r),a=n.getOffsetAt(s),c=n.model.sharedModel.getSource().substring(l,a);return l>a&&([r,s]=[s,r]),{...i,start:r,end:s,text:c,widgetId:e.id,...o&&{cellId:o}}}(this._mainAreaWidget);(null==e?void 0:e.text)!==(null==t?void 0:t.text)&&(this._selection=t,this._selectionChanged.emit(t))}}var q,K=n(48820),Y=n(28142);async function X(e="",t={}){const n=K.ServerConnection.makeSettings(),o=Y.URLExt.join(n.baseUrl,"api/ai",e);let r;try{r=await K.ServerConnection.makeRequest(o,t,n)}catch(e){throw new K.ServerConnection.NetworkError(e)}let s=await r.text();if(s.length>0)try{s=JSON.parse(s)}catch(e){console.log("Not a JSON response body.",r)}if(!r.ok)throw new K.ServerConnection.ResponseError(r,s.message||s);return s}!function(e){e.sendPrompt=async function(e){let t;try{t=await X("prompt",{method:"POST",body:JSON.stringify(e)})}catch(e){return Promise.reject(e)}return t},e.listTasks=async function(){return X("tasks")},e.describeTask=async function(e){return X(`tasks/${e}`)}}(q||(q={}));class ee{constructor(e={}){var t;this.id="",this._sendResolverQueue=[],this._replyForResolverDict={},this._isDisposed=!1,this._socket=null,this._listeners=[],this.serverSettings=null!==(t=e.serverSettings)&&void 0!==t?t:K.ServerConnection.makeSettings()}initialize(){return new Promise(((e,t)=>{if(this.isDisposed)return;const{token:n,WebSocket:o,wsUrl:r}=this.serverSettings,s=Y.URLExt.join(r,"api/ai/chats")+(n?`?token=${encodeURIComponent(n)}`:""),i=this._socket=new o(s);i.onerror=e=>t(e),i.onmessage=e=>e.data&&this._onMessage(JSON.parse(e.data));const l=t=>{"connection"===t.type&&(this.id=t.client_id,e(),this.removeListener(l))};this.addListener(l)}))}sendMessage(e){return new Promise((t=>{var n;null===(n=this._socket)||void 0===n||n.send(JSON.stringify(e)),this._sendResolverQueue.push(t)}))}replyFor(e){return new Promise((t=>{this._replyForResolverDict[e]=t}))}addListener(e){this._listeners.push(e)}removeListener(e){const t=this._listeners.indexOf(e);t>-1&&this._listeners.splice(t,1)}async getHistory(){let e={messages:[]};try{e=await X("chats/history",{method:"GET"})}catch(e){return Promise.reject(e)}return e}get isDisposed(){return this._isDisposed}dispose(){if(this.isDisposed)return;this._isDisposed=!0,this._listeners=[];const e=this._socket;e&&(this._socket=null,e.onopen=()=>{},e.onerror=()=>{},e.onmessage=()=>{},e.onclose=()=>{},e.close())}_onMessage(e){var t;"human"===e.type&&e.client.id===this.id&&(null===(t=this._sendResolverQueue.shift())||void 0===t||t(e.id)),"agent"===e.type&&e.reply_to in this._replyForResolverDict&&(this._replyForResolverDict[e.reply_to](e),delete this._replyForResolverDict[e.reply_to]),this._listeners.forEach((t=>t(e)))}}const te={id:"jupyter_ai:plugin",autoStart:!0,optional:[r.IGlobalAwareness,o.ILayoutRestorer],activate:async(e,t,n)=>{const o=new Q(e.shell),r=new ee;let s=null;try{await r.initialize(),s=function(e,t,n){const o=l.ReactWidget.create(i().createElement(F,{selectionWatcher:e,chatHandler:t,globalAwareness:n}));return o.id="jupyter-ai::chat",o.title.icon=W,o.title.caption="Jupyter AI Chat",o}(o,r,t)}catch(e){s=function(){const e=l.ReactWidget.create(i().createElement(p,null,i().createElement(m.Box,{sx:{width:"100%",height:"100%",boxSizing:"border-box",background:"var(--jp-layout-color0)",display:"flex",flexDirection:"column"}},i().createElement(m.Box,{sx:{padding:4}},i().createElement(m.Alert,{severity:"error"},"There seems to be a problem with the Chat backend, please look at the JupyterLab server logs or contact your administrator to correct this problem.")))));return e.id="jupyter-ai::chat",e.title.icon=W,e.title.caption="Jupyter AI Chat",e}()}e.shell.add(s,"left",{rank:2e3}),n&&n.add(s,"jupyter-ai-chat")}}}}]);