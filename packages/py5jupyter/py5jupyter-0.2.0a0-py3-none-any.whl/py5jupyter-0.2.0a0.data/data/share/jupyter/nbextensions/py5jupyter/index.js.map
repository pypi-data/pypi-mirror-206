{"version":3,"file":"index.js","mappings":"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","sources":["webpack://jupyter-py5/./src/extension.ts","webpack://jupyter-py5/./src/index.ts","webpack://jupyter-py5/./src/utils.ts","webpack://jupyter-py5/./src/version.ts","webpack://jupyter-py5/./src/widget.ts","webpack://jupyter-py5/external amd \"@jupyter-widgets/base\"","webpack://jupyter-py5/webpack/bootstrap","webpack://jupyter-py5/webpack/startup"],"sourcesContent":["// *****************************************************************************\n//\n//   Part of the py5jupyter (& py5) library\n//   Copyright (C) 2022-2023 Jim Schmitz\n//\n//   This library is free software: you can redistribute it and/or modify it\n//   under the terms of the GNU Lesser General Public License as published by\n//   the Free Software Foundation, either version 2.1 of the License, or (at\n//   your option) any later version.\n//\n//   This library is distributed in the hope that it will be useful, but\n//   WITHOUT ANY WARRANTY; without even the implied warranty of\n//   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser\n//   General Public License for more details.\n//\n//   You should have received a copy of the GNU Lesser General Public License\n//   along with this library. If not, see <https://www.gnu.org/licenses/>.\n//\n// *****************************************************************************\n// Entry point for the notebook bundle containing custom model definitions.\n\n// Some static assets may be required by the custom widget javascript. The base\n// url for the notebook is not known at build time and is therefore computed\n// dynamically.\n// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n(window as any).__webpack_public_path__ =\n  document.querySelector('body')!.getAttribute('data-base-url') +\n  'nbextensions/py5jupyter';\n\nexport * from './index';\n","// *****************************************************************************\n//\n//   Part of the py5jupyter (& py5) library\n//   Copyright (C) 2022-2023 Jim Schmitz\n//\n//   This library is free software: you can redistribute it and/or modify it\n//   under the terms of the GNU Lesser General Public License as published by\n//   the Free Software Foundation, either version 2.1 of the License, or (at\n//   your option) any later version.\n//\n//   This library is distributed in the hope that it will be useful, but\n//   WITHOUT ANY WARRANTY; without even the implied warranty of\n//   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser\n//   General Public License for more details.\n//\n//   You should have received a copy of the GNU Lesser General Public License\n//   along with this library. If not, see <https://www.gnu.org/licenses/>.\n//\n// *****************************************************************************\nexport * from './version';\nexport * from './widget';\n","// *****************************************************************************\n//\n//   Part of the py5jupyter (& py5) library\n//   Copyright (C) 2022-2023 Jim Schmitz\n//\n//   This library is free software: you can redistribute it and/or modify it\n//   under the terms of the GNU Lesser General Public License as published by\n//   the Free Software Foundation, either version 2.1 of the License, or (at\n//   your option) any later version.\n//\n//   This library is distributed in the hope that it will be useful, but\n//   WITHOUT ANY WARRANTY; without even the implied warranty of\n//   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser\n//   General Public License for more details.\n//\n//   You should have received a copy of the GNU Lesser General Public License\n//   along with this library. If not, see <https://www.gnu.org/licenses/>.\n//\n// *****************************************************************************\n\n// The below function came from the wonderful Python library ipycanvas\n// https://github.com/martinRenou/ipycanvas\n\nexport async function bufferToImage(buffer: any): Promise<HTMLImageElement> {\n    let url: string;\n\n    const blob = new Blob([buffer], { type: 'image/jpeg' });\n    url = URL.createObjectURL(blob);\n\n    const img = new Image();\n    return new Promise(resolve => {\n        img.onload = () => {\n            resolve(img);\n        };\n        img.src = url;\n    });\n}\n","// *****************************************************************************\n//\n//   Part of the py5jupyter (& py5) library\n//   Copyright (C) 2022-2023 Jim Schmitz\n//\n//   This library is free software: you can redistribute it and/or modify it\n//   under the terms of the GNU Lesser General Public License as published by\n//   the Free Software Foundation, either version 2.1 of the License, or (at\n//   your option) any later version.\n//\n//   This library is distributed in the hope that it will be useful, but\n//   WITHOUT ANY WARRANTY; without even the implied warranty of\n//   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser\n//   General Public License for more details.\n//\n//   You should have received a copy of the GNU Lesser General Public License\n//   along with this library. If not, see <https://www.gnu.org/licenses/>.\n//\n// *****************************************************************************\n\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\n// eslint-disable-next-line @typescript-eslint/no-var-requires\nconst data = require('../package.json');\n\n/**\n * The _model_module_version/_view_module_version this package implements.\n *\n * The html widget manager assumes that this is the same as the npm package\n * version number.\n */\nexport const MODULE_VERSION = data.version;\n\n/*\n * The current package name.\n */\nexport const MODULE_NAME = data.name;\n","// *****************************************************************************\n//\n//   Part of the py5jupyter (& py5) library\n//   Copyright (C) 2022-2023 Jim Schmitz\n//\n//   This library is free software: you can redistribute it and/or modify it\n//   under the terms of the GNU Lesser General Public License as published by\n//   the Free Software Foundation, either version 2.1 of the License, or (at\n//   your option) any later version.\n//\n//   This library is distributed in the hope that it will be useful, but\n//   WITHOUT ANY WARRANTY; without even the implied warranty of\n//   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser\n//   General Public License for more details.\n//\n//   You should have received a copy of the GNU Lesser General Public License\n//   along with this library. If not, see <https://www.gnu.org/licenses/>.\n//\n// *****************************************************************************\nimport {\n  DOMWidgetModel,\n  DOMWidgetView,\n} from '@jupyter-widgets/base';\n\nimport { MODULE_NAME, MODULE_VERSION } from './version';\n\nimport {\n  bufferToImage\n} from './utils';\n\n// https://ipywidgets.readthedocs.io/en/latest/examples/Widget%20Low%20Level.html\n\nexport class Py5SketchPortalModel extends DOMWidgetModel {\n  defaults() {\n    return {\n      ...super.defaults(),\n      _model_name: Py5SketchPortalModel.model_name,\n      _model_module: Py5SketchPortalModel.model_module,\n      _model_module_version: Py5SketchPortalModel.model_module_version,\n      _view_name: Py5SketchPortalModel.view_name,\n      _view_module: Py5SketchPortalModel.view_module,\n      _view_module_version: Py5SketchPortalModel.view_module_version,\n      width: '',\n      height: '',\n      value: new DataView(new ArrayBuffer(0)),\n    };\n  }\n\n  static serializers = {\n    ...DOMWidgetModel.serializers,\n    value: {\n      serialize: (value: any): DataView => {\n        return new DataView(value.buffer.slice(0));\n      },\n    },\n  };\n\n  static model_name = 'Py5SketchPortalModel';\n  static model_module = MODULE_NAME;\n  static model_module_version = MODULE_VERSION;\n  static view_name = 'Py5SketchPortalView';\n  static view_module = MODULE_NAME;\n  static view_module_version = MODULE_VERSION;\n}\n\nexport class Py5SketchPortalView extends DOMWidgetView {\n  private _canvas: HTMLCanvasElement;\n  private _ctx: CanvasRenderingContext2D;\n\n  render() {\n    this._canvas = document.createElement('canvas');\n    this._canvas.width = this.model.get('width');\n    this._canvas.height = this.model.get('height');\n    this._canvas.tabIndex = 0;\n\n    const ctx = this._canvas.getContext('2d');\n    if (ctx === null) {\n      throw 'Could not create 2d context.';\n    } else {\n      this._ctx = ctx;\n    }\n\n    this._updateImgSrc();\n    this.el.appendChild(this._canvas);\n\n    this._canvas.addEventListener('keydown', {\n      handleEvent: this.onKeyEvent.bind(this, 'key_down')\n    });\n    this._canvas.addEventListener('keypress', {\n      handleEvent: this.onKeyEvent.bind(this, 'key_press')\n    });\n    this._canvas.addEventListener('keyup', {\n      handleEvent: this.onKeyEvent.bind(this, 'key_up')\n    });\n    this._canvas.addEventListener('mouseenter', {\n      handleEvent: this.onMouseEvent.bind(this, 'mouse_enter')\n    });\n    this._canvas.addEventListener('mousedown', {\n      handleEvent: this.onMouseDown.bind(this)\n    });\n    this._canvas.addEventListener('mousemove', {\n      handleEvent: this.onMouseEvent.bind(this, 'mouse_move')\n    });\n    this._canvas.addEventListener('mouseup', {\n      handleEvent: this.onMouseEvent.bind(this, 'mouse_up')\n    });\n    this._canvas.addEventListener('mouseleave', {\n      handleEvent: this.onMouseEvent.bind(this, 'mouse_leave')\n    });\n    this._canvas.addEventListener('click', {\n      handleEvent: this.onMouseEvent.bind(this, 'mouse_click')\n    });\n    this._canvas.addEventListener('wheel', {\n      handleEvent: this.onMouseWheel.bind(this)\n    });\n\n    // Python -> JavaScript update\n    this.model.on('change:value', this._updateImgSrc, this);\n  }\n\n  private async _updateImgSrc() {\n    const img = await bufferToImage(this.model.get('value'));\n    this._ctx.drawImage(img, 0, 0);\n  }\n\n  // https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent\n\n  private onKeyEvent(event_name: string, event: KeyboardEvent) {\n    this.model.send({ event: event_name, key: event.key, repeat: event.repeat, ...this.getModifiers(event) }, {});\n  }\n\n  private onMouseEvent(event_name: string, event: MouseEvent) {\n    this.model.send({ event: event_name, buttons: event.buttons, ...this.getModifiers(event), ...this.getCoordinates(event) }, {});\n  }\n\n  private onMouseDown(event: MouseEvent) {\n    // Bring focus to the img element, so keyboard events can be triggered\n    this._canvas.focus();\n\n    this.model.send({ event: 'mouse_down', buttons: event.buttons, ...this.getModifiers(event), ...this.getCoordinates(event) }, {});\n  }\n\n  // https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers\n\n  private onMouseWheel(event: WheelEvent) {\n    this.model.send({ event: 'mouse_wheel', buttons: event.buttons, wheel: ((event.deltaY != 0) ? event.deltaY : event.deltaX), ...this.getModifiers(event), ...this.getCoordinates(event) }, {});\n  }\n\n  protected getCoordinates(event: MouseEvent | Touch) {\n    // https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent\n    const rect = this._canvas.getBoundingClientRect();\n\n    const x = (this._canvas.width * (event.clientX - rect.left)) / rect.width;\n    const y = (this._canvas.height * (event.clientY - rect.top)) / rect.height;\n\n    return { x, y };\n  }\n\n  protected getModifiers(event: MouseEvent | KeyboardEvent) {\n    return { mod: (+event.shiftKey) * 1 + (+event.ctrlKey) * 2 + (+event.metaKey) * 4 + (+event.altKey) * 8 };\n  }\n\n}\n","module.exports = __WEBPACK_EXTERNAL_MODULE__146__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(112);\n"],"names":["window","__webpack_public_path__","document","querySelector","getAttribute","buffer","url","blob","Blob","type","URL","createObjectURL","img","Image","Promise","resolve","onload","src","data","MODULE_VERSION","version","MODULE_NAME","name","Py5SketchPortalModel","DOMWidgetModel","defaults","super","_model_name","model_name","_model_module","model_module","_model_module_version","model_module_version","_view_name","view_name","_view_module","view_module","_view_module_version","view_module_version","width","height","value","DataView","ArrayBuffer","serializers","serialize","slice","Py5SketchPortalView","DOMWidgetView","render","this","_canvas","createElement","model","get","tabIndex","ctx","getContext","_ctx","_updateImgSrc","el","appendChild","addEventListener","handleEvent","onKeyEvent","bind","onMouseEvent","onMouseDown","onMouseWheel","on","bufferToImage","drawImage","event_name","event","send","key","repeat","getModifiers","buttons","getCoordinates","focus","wheel","deltaY","deltaX","rect","getBoundingClientRect","x","clientX","left","y","clientY","top","mod","shiftKey","ctrlKey","metaKey","altKey","module","exports","__WEBPACK_EXTERNAL_MODULE__146__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","call"],"sourceRoot":""}